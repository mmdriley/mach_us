%!PS-Adobe-2.0
%%Creator: dvips by Radical Eye Software
%%Title: us_clues.dvi
%%Pages: 21 1
%%BoundingBox: 0 0 612 792
%%EndComments
%%BeginDocument: tex.pro
/TeXDict 200 dict def TeXDict begin /bdf{bind def}def /bop-aux{}bdf /@rigin{
/@page-height exch def /@page-width exch def 72 Resolution div dup neg scale
translate}bdf /@letter{Resolution dup -10 mul 8.5 11 @rigin}bdf /@landscape{[
0 1 -1 0 0 0]concat Resolution dup 8.5 11 @rigin}bdf /@a4{Resolution dup
-10.6929133858 mul 21 2.54 div 29.7 2.54 div @rigin}bdf /@legal{Resolution dup
-13 mul 8.5 14 @rigin}bdf /@11x17{statusdict /11x17tray known{statusdict begin
11x17tray end}if Resolution dup -16 mul 11 17 @rigin}bdf /@manualfeed{
statusdict /manualfeed true put}bdf /@copies{/#copies exch def}bdf /@draft{
/bop-aux{gsave initmatrix 72 dup scale @page-width 2 div @page-height 2 div
translate @page-height @page-width atan rotate /Helvetica-Bold findfont 2
scalefont setfont(DRAFT)dup stringwidth pop 2 div neg -1 moveto .95 setgray
show grestore}bdf}bdf /@FontMatrix[1 0 0 -1 0 0]def /@FontBBox[0 0 0 0]def
/dmystr(ZZf@@@)def /newname{dmystr cvn}bdf /df{/fontname exch def dmystr 2
fontname cvx(@@@@)cvs putinterval newname 7 dict def newname load begin
/FontType 3 def /FontMatrix @FontMatrix def /FontBBox @FontBBox def /BitMaps
256 array def /BuildChar{CharBuilder}def /Encoding IdentityEncoding def end
fontname{/foo setfont}2 array copy cvx def fontname load 0 dmystr 6 string
copy cvn cvx put}bdf /dfe{newname dup load definefont setfont}bdf /ch-image{
ch-data 0 get}bdf /ch-width{ch-data 1 get}bdf /ch-height{ch-data 2 get}bdf
/ch-xoff{ch-data 3 get}bdf /ch-yoff{ch-data 4 get}bdf /ch-dx{ch-data 5 get}
bdf /CharBuilder{save 3 1 roll exch /BitMaps get exch get /ch-data exch def
ch-data null ne{ch-dx 0 ch-xoff ch-yoff neg ch-xoff ch-width add ch-height
ch-yoff sub setcachedevice ch-width ch-height true[1 0 0 -1 -.1 ch-xoff sub
ch-height ch-yoff sub .1 add]{ch-image}imagemask}if restore}bdf /dc{/ch-code
exch def /ch-data exch def newname load /BitMaps get ch-code ch-data put}bdf
/bop{gsave /SaveImage save def /bop-aux load exec 0 0 moveto}bdf /eop{clear
SaveImage restore showpage grestore}bdf /@start{/Resolution exch def
/IdentityEncoding 256 array def 0 1 255{IdentityEncoding exch 1 string dup 0 3
index put cvn put}for}bdf /p{show}bdf /RuleMatrix[1 0 0 -1 -.1 -.1]def
/BlackDots 8 string def /v{gsave currentpoint translate false RuleMatrix{
BlackDots}imagemask grestore}bdf /a{moveto}bdf /delta 0 def /tail{dup /delta
exch def 0 rmoveto}bdf /b{exch show tail}bdf /c{show delta 4 sub tail}bdf /d{
show delta 3 sub tail}bdf /e{show delta 2 sub tail}bdf /f{show delta 1 sub
tail}bdf /g{show delta 0 rmoveto}bdf /h{show delta 1 add tail}bdf /i{show
delta 2 add tail}bdf /j{show delta 3 add tail}bdf /k{show delta 4 add tail}
bdf /l{show -4 0 rmoveto}bdf /m{show -3 0 rmoveto}bdf /n{show -2 0 rmoveto}
bdf /o{show -1 0 rmoveto}bdf /q{show 1 0 rmoveto}bdf /r{show 2 0 rmoveto}bdf
/s{show 3 0 rmoveto}bdf /t{show 4 0 rmoveto}bdf /w{0 rmoveto}bdf /x{0 exch
rmoveto}bdf /y{3 2 roll show moveto}bdf /bos{/section save def}bdf /eos{clear
section restore}bdf end
%%EndDocument
%%BeginDocument: texps.pro
TeXDict begin /rf{655360 div mul Resolution mul 7227 div /PixPerEm exch def
findfont dup length 1 add dict /newfont exch def{1 index /FID ne{newfont 3 1
roll put}{pop pop}ifelse}forall 256 dict begin newfont /Encoding get 255 -1 0{
2 copy get 4 -1 roll 1000 mul PixPerEm div def pop}for pop newfont /Metrics
currentdict put end /fontname exch def dmystr 2 fontname cvx(@@@@)cvs
putinterval newname dup newfont definefont[PixPerEm 0 0 PixPerEm neg 0 0]
makefont def fontname{/foo setfont}2 array copy cvx def fontname load 0 dmystr
6 string copy cvn cvx put}bdf /ObliqueSlant{dup sin exch cos div neg}bdf
/SlantFont{/foo exch def[1 0 foo 1 0 0]TransFont}bdf /ExtendFont{/foo exch def
258 2 roll 0 1 255{pop foo div 256 1 roll}for 258 -2 roll[foo 0 0 1 0 0]
TransFont}bdf /TransFont{exch findfont exch makefont dup length dict /newfont
exch def{1 index /FID ne{newfont 3 1 roll put}{pop pop}ifelse}forall dup
newfont definefont pop}bdf end
%%EndDocument
%%BeginDocument: special.pro
TeXDict begin /SDict 200 dict def SDict begin /@SpecialDefaults{/hs 612 def
/vs 792 def /ho 0 def /vo 0 def /hsc 1 def /vsc 1 def /ang 0 def /CLIP false
def /BBcalc false def}bdf /@scaleunit 1 def /@hscale{@scaleunit div /hsc exch
def}bdf /@vscale{@scaleunit div /vsc exch def}bdf /@hsize{/hs exch def /CLIP
true def}bdf /@vsize{/vs exch def /CLIP true def}bdf /@hoffset{/ho exch def}
bdf /@voffset{/vo exch def}bdf /@angle{/ang exch def}bdf /@rwi{10 div /rwi
exch def}bdf /@llx{/llx exch def}bdf /@lly{/lly exch def}bdf /@urx{/urx exch
def}bdf /@ury{/ury exch def /BBcalc true def}bdf end /@MacSetUp{userdict /md
known{userdict /md get type /dicttype eq{md begin /letter{}def /note{}def
/legal{}def /od{txpose 1 0 mtx defaultmatrix dtransform exch atan/pa exch def
newpath clippath mark{transform{itransform moveto}}{transform{itransform
lineto}}{6 -2 roll transform 6 -2 roll transform 6 -2 roll transform{
itransform 6 2 roll itransform 6 2 roll itransform 6 2 roll curveto}}{{
closepath}}pathforall newpath counttomark array astore /gc xdf pop ct 39 0 put
10 fz 0 fs 2 F/|______Courier fnt invertflag{PaintBlack}if}def /txpose{pxs pys
scale ppr aload pop por{noflips{pop exch neg exch translate pop 1 -1 scale}if
xflip yflip and{pop exch neg exch translate 180 rotate 1 -1 scale ppr 3 get
ppr 1 get neg sub neg ppr 2 get ppr 0 get neg sub neg translate}if xflip yflip
not and{pop exch neg exch translate pop 180 rotate ppr 3 get ppr 1 get neg sub
neg 0 translate}if yflip xflip not and{ppr 1 get neg ppr 0 get neg translate}
if}{noflips{translate pop pop 270 rotate 1 -1 scale}if xflip yflip and{
translate pop pop 90 rotate 1 -1 scale ppr 3 get ppr 1 get neg sub neg ppr 2
get ppr 0 get neg sub neg translate}if xflip yflip not and{translate pop pop
90 rotate ppr 3 get ppr 1 get neg sub neg 0 translate}if yflip xflip not and{
translate pop pop 270 rotate ppr 2 get ppr 0 get neg sub neg 0 exch translate}
if}ifelse scaleby96{ppr aload pop 4 -1 roll add 2 div 3 1 roll add 2 div 2
copy translate .96 dup scale neg exch neg exch translate}if}def /cp{pop pop
showpage pm restore}def end}if}if}def /psf$TeXscale{65536 div}def /startTexFig
{/psf$SavedState save def userdict maxlength dict begin Resolution 72 div dup
neg scale currentpoint translate /psf$ury exch psf$TeXscale def /psf$urx exch
psf$TeXscale def /psf$lly exch psf$TeXscale def /psf$llx exch psf$TeXscale def
/psf$y exch psf$TeXscale def /psf$x exch psf$TeXscale def currentpoint /psf$cy
exch def /psf$cx exch def /psf$sx psf$x psf$urx psf$llx sub div def /psf$sy
psf$y psf$ury psf$lly sub div def psf$sx psf$sy scale psf$cx psf$sx div
psf$llx sub psf$cy psf$sy div psf$ury sub translate /showpage{}def /erasepage{
}def /copypage{}def @MacSetUp}def /doclip{psf$llx psf$lly psf$urx psf$ury
currentpoint 6 2 roll newpath 4 copy 4 2 roll moveto 6 -1 roll exch lineto
exch lineto exch lineto closepath clip newpath moveto}def /endTexFig{end
psf$SavedState restore}def /@beginspecial{SDict begin /SpecialSave save def
Resolution 72 div dup neg scale currentpoint translate @SpecialDefaults}bdf
/@setspecial{CLIP{newpath 0 0 moveto hs 0 rlineto 0 vs rlineto hs neg 0
rlineto closepath clip}{initclip}ifelse ho vo translate hsc vsc scale ang
rotate BBcalc{rwi urx llx sub div dup scale llx neg lly neg translate}if
/showpage{}def newpath}bdf /@endspecial{clear SpecialSave restore end}bdf
/@defspecial{SDict begin}bdf /@fedspecial{end}bdf /li{lineto}bdf /rl{rlineto}
bdf /rc{rcurveto}bdf /np{/SaveX currentpoint /SaveY exch def def newpath}bdf
/st{stroke SaveX SaveY moveto}bdf /fil{fill SaveX SaveY moveto}bdf /ellipse{
/endangle exch def /startangle exch def /yrad exch def /xrad exch def
/savematrix matrix currentmatrix def translate xrad yrad scale 0 0 1
startangle endangle arc savematrix setmatrix}bdf end
%%EndDocument
TeXDict begin @defspecial
 /@scaleunit 100 def 
@fedspecial end TeXDict begin 300 @start /fa 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 27 27 27 27 27 27 27
27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27
27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27
27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27
27 27 27 27 27 27 27 27 27 27 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 27 27 27 27 27 27 27 27 27 27 27 27 27 0 0 0 27 27 27 27 0
27 27 27 27 27 27 27 0 0 27 0 27 27 27 27 27 27 27 27 0 27 27 0 27 27 27 27 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 27 0 0 0 0 27 27 0 27 0 0 0 0 0 0 0 0 0 27 0
0 27 27 0 27 0 0 0 0 /Courier 1000 717619 rf /fb df[<01800180018001800180C183
F18F399C0FF003C003C00FF0399CF18FC18301800180018001800180>16 20 3 -1 23]3 dc[<
03C00FF01FF83FFC7FFE7FFEFFFFFFFFFFFFFFFFFFFFFFFF7FFE7FFE3FFC1FF80FF003C0>16 18
3 -2 23]15 dc[<000F0038006000E001C001C001C001C001C001C001C001C001C001C001C001
C001C001C001C0038007001E00F8001E000700038001C001C001C001C001C001C001C001C001C0
01C001C001C001C001C001C000E000600038000F>16 45 3 11 23]102 dc[<F8001E00070003
8001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C000E000600038000F
0038006000E001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C0038007
001E00F800>16 45 3 11 23]103 dc dfe /fc 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 11 15 19 23 23 38 35 15 15 15 23 31 11 15 11 13 23
23 23 23 23 23 23 23 23 23 15 15 31 31 31 23 42 28 28 30 33 28 28 33 33 15 20
30 25 38 30 33 28 33 28 23 25 33 28 38 28 25 25 18 13 18 19 23 15 23 23 20 23
20 13 23 23 13 13 20 13 33 23 23 23 23 18 18 13 23 20 30 20 20 18 18 12 18 25
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 18 23 23 8
23 23 23 23 10 25 23 15 15 23 23 0 23 23 23 11 0 24 16 15 25 25 23 40 45 0 23
0 15 15 15 15 15 15 15 15 0 15 15 0 15 15 15 40 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 40 0 13 0 0 0 0 25 33 43 14 0 0 0 0 0 30 0 0 0 13 0 0 13 23 30 23 0 0 0 0
/Times-Italic 1000 717619 rf /fd 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 11 15 19 23 23 38 35 15 15 15 23 26 11 15 11 13 23 23 23 23
23 23 23 23 23 23 13 13 26 26 26 20 42 33 30 30 33 28 25 33 33 15 18 33 28 40
33 33 25 33 30 25 28 33 33 43 33 33 28 15 13 15 21 23 15 20 23 20 23 20 15 23
23 13 13 23 13 35 23 23 23 23 15 18 13 23 23 33 23 23 20 22 9 22 25 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 15 23 23 8 23 23 23
23 8 20 23 15 15 25 25 0 23 23 23 11 0 21 16 15 20 20 23 45 45 0 20 0 15 15 15
15 15 15 15 15 0 15 15 0 15 15 15 45 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 40 0 13 0
0 0 0 28 33 40 14 0 0 0 0 0 30 0 0 0 13 0 0 13 23 33 23 0 0 0 0 /Times-Roman
1000 717619 rf /fe 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 11 15 25 23 23 45 38 15 15 15 23 26 11 15 11 13 23 23 23 23 23 23 23 23 23
23 15 15 26 26 26 23 42 33 30 33 33 30 28 35 35 18 23 35 30 43 33 35 28 35 33
25 30 33 33 45 33 33 30 15 13 15 26 23 15 23 25 20 25 20 15 23 25 13 15 25 13
38 25 23 25 25 20 18 15 25 23 33 23 23 20 18 10 18 24 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 15 23 23 8 23 23 23 23 13 23 23 15
15 25 25 0 23 23 23 11 0 25 16 15 23 23 23 45 45 0 23 0 15 15 15 15 15 15 15
15 0 15 15 0 15 15 15 45 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 45 0 14 0 0 0 0 30 35
45 15 0 0 0 0 0 33 0 0 0 13 0 0 13 23 33 25 0 0 0 0 /Times-Bold 1000 717619 rf
/ff 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 12 17 28
25 25 50 41 17 17 17 25 28 12 17 12 14 25 25 25 25 25 25 25 25 25 25 17 17 28
28 28 25 46 36 33 36 36 33 30 39 39 19 25 39 33 47 36 39 30 39 36 28 33 36 36
50 36 36 33 17 14 17 29 25 17 25 28 22 28 22 17 25 28 14 17 28 14 41 28 25 28
28 22 19 17 28 25 36 25 25 22 20 11 20 26 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 17 25 25 8 25 25 25 25 14 25 25 17 17 28 28 0
25 25 25 12 0 27 17 17 25 25 25 50 50 0 25 0 17 17 17 17 17 17 17 17 0 17 17 0
17 17 17 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 50 0 15 0 0 0 0 33 39 50 16 0 0 0
0 0 36 0 0 0 14 0 0 14 25 36 28 0 0 0 0 /Times-Bold 1000 786432 rf /fg 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 12 17 20 25 25 41 39
17 17 17 25 28 12 17 12 14 25 25 25 25 25 25 25 25 25 25 14 14 28 28 28 22 46
36 33 33 36 30 28 36 36 17 19 36 30 44 36 36 28 36 33 28 30 36 36 47 36 36 30
17 14 17 23 25 17 22 25 22 25 22 17 25 25 14 14 25 14 39 25 25 25 25 17 19 14
25 25 36 25 25 22 24 10 24 27 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 17 25 25 8 25 25 25 25 9 22 25 17 17 28 28 0 25 25 25 12 0
23 17 17 22 22 25 50 50 0 22 0 17 17 17 17 17 17 17 17 0 17 17 0 17 17 17 50 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 44 0 14 0 0 0 0 30 36 44 15 0 0 0 0 0 33 0 0 0
14 0 0 14 25 36 25 0 0 0 0 /Times-Roman 1000 786432 rf /fh 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 18 24 29 36 36 60 56 24 24 24 36
40 18 24 18 20 36 36 36 36 36 36 36 36 36 36 20 20 40 40 40 32 66 52 48 48 52
44 40 52 52 24 28 52 44 64 52 52 40 52 48 40 44 52 52 68 52 52 44 24 20 24 34
36 24 32 36 32 36 32 24 36 36 20 20 36 20 56 36 36 36 36 24 28 20 36 36 52 36
36 32 34 14 34 39 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 24 36 36 12 36 36 36 36 13 32 36 24 24 40 40 0 36 36 36 18 0 32 25 24
32 32 36 72 72 0 32 0 24 24 24 24 24 24 24 24 0 24 24 0 24 24 24 72 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 64 0 20 0 0 0 0 44 52 64 22 0 0 0 0 0 48 0 0 0 20 0 0 20
36 52 36 0 0 0 0 /Times-Roman 1000 1132462 rf end
 TeXDict begin @letter
%%EndProlog
%%Page: 1 1
 bop 496 219 a fh(Mach)18 b(US:)f(Clues)g(For)h(Developers,)760 310 y(A)g(Bra\
in)f(Dump)789 478 y fg(J.)c(Mark)f(Stevenson)688 594 y(School)g(of)g(Computer)
f(Science)694 652 y(Carnegie)h(Mellon)h(University)761 710 y(Pittsbur)n(gh,)g
(P)-5 b(A)12 b(15213)802 769 y(jms@cs.cmu.edu)805 885 y(Included)f(text)i(by:)
616 943 y(Daniel)g(P)-6 b(.)13 b(Julin,)f(dpj@isis.status.com)596 1001 y(Mary)
g(R.)h(Thompson,)g(mrt@cs.cmu.edu)681 1144 y ff(DRAFT)g fg(of)f(October)g(27,)
g(1994)62 1354 y(This)g(is)g(an)g(informal)e(incomplete)h(working)g(document.)
17 b(The)12 b(information)e(presented)i(herein)f(is)h(subject)0 1411 y(to)g
(change)h(without)e(notice.)0 1579 y fe(1.)46 b(Intr)o(o)0 1724 y fd(The)10 b
(purpose)f(of)i(this)e(document)g(is)h(to)g(give)f(new)i(researchers)f(with)g
(Mach-US)h(and)f(idea)g(as)g(to)g(how)f(to)h(procede)g(when)0 1781 y(making)
16 b(modi\256cations)f(to)h(the)g(system.)31 b(This)16 b(document)f(assumes)h
(that)g(the)g(researcher)h(is)f(familiar)g(with)g(object)0 1837 y(oriented)11
b(programming,)g(the)h(Mach-3.0)g(kernel,)g(and)f(has)h(read)g(some)f(of)h
(the)f(introductory)f(docs)h(to)g(Mach-US.)i(This)0 1894 y(document)e(is)g
(not)f(meant)i(to)f(be)g(a)h(reference)g(guide)f(to)g(the)g(system)f(or)i(a)f
(complete)h(internals)e(document.)16 b(Instead)11 b(it)g(is)0 1950 y(in)e(the)
g(form)h(of)g(a)g(brain)f(dump)g(on)g(the)g(part)h(of)f(an)h(individual)d(who)
i(is)g(intimately)f(familiar)h(with)g(the)g(system,)h(and)f(some)0 2006 y(inf\
o)k(about)h(what)f(he/I)h(thought)e(someone)i(using)e(the)i(system)g(might)f
(want/need)g(to)g(know)m(.)25 b(This)13 b(is)g(not)g(a)i(polished)0 2063 y
(formal)d(document,)h(and)e(was)h(written)f(under)h(serious)f(time)h(constrai\
nts.)18 b(On)11 b(the)h(other)g(hand,)g(for)g(those)f(researchers)0 2119 y
(who)g(wish)f(to)h(get)f(deep)i(into)e(the)h(system,)g(this)f(will)g(be)h(a)h
(very)f(valuable)f(source)h(of)g(information.)0 2288 y fe(2.)46 b(Overview/Re\
ligion:)14 b(What)e(is)f(Mach-US)0 2433 y fd(The)f(Mach-US)h(operating)e(syst\
em)h(has)g(been)g(created)h(as)f(part)g(of)g(the)g(Carnegie-Mellon)g(Universi\
ty)f(MACH)h(project.)0 2489 y(It)h(is)g(an)g(OS)g(which)g(uses)f(the)h(CMU)h
(Mach3.0)g(kernel)e(and)h(runs)g(today)f(on)h(i386/i486)e(based)h(hardware)i
(supported)d(by)0 2546 y(Mach3.0)j(including)d(most)i(IBM)h(clones,)f(and)g
(the)g(Sequent)f(Symmetry)i(multi-processor)l(.)62 2644 y(It)c(currently)g
(supplies)e(a)i(Mach3.0/4.3BSD)h(API)f(and)g(runs)f(most)h(non-administrative)
e(UNIX)h(applications.)14 b(There)0 2700 y(is)d(no)f(re-compilation)g(or)i
(re-linking)d(required.)962 2804 y(1)p eop
%%Page: 2 2
 bop 0 42 a fe(Quick)10 b(System)f(Architecture)h(Overview)45 b fd(Mach-US)10
b(is)f(referred)h(to)f(as)g(a)h(symmetric)f(multi-server)g(OS)g(emulation)0 98
y(system.)16 b(It)11 b(has)g(a)h(set)e(of)i(separate)f(servers)g(supplying)e
(generalized)h(system)h(services)g(\(\256le)g(systems,)g(network)f(server)o
(,)0 154 y(process-mgr)n(,)16 b(tty)e(server)n(,...\))29 b(and)14 b(an)h(emul\
ation)f(library)g(loaded)g(into)g(each)h(user)g(process.)26 b(This)14 b(libra\
ry)g(uses)g(the)0 211 y(services)e(to)f(generate)i(the)e(semantics)h(of)g(an)
g(industry)f(standard)g(OS)h(being)g(emulated.)19 b(Some)13 b(of)f(the)g(syst\
em)f(servers)0 267 y(are,)i(in)f(part)g(or)g(whole,)g(speci\256c)g(to)f(the)h
(OS)g(being)f(emulated)h(while)f(most)h(are)h(meant)f(to)g(be)g(fully)f(gener\
ic.)19 b(Thought)0 324 y(was)14 b(given)f(when)h(writing)e(the)i(OS)g(speci\
\256c)g(ones)f(to)h(make)g(parts)g(of)g(them)g(reusable)g(for)g(other)f(OS')n
(s.)25 b(There)14 b(is)f(no)0 380 y("central")f(server)n(,)j(either)e(for)g
(emulating)f(a)i(speci\256c)f(OS)h(or)f(for)g(general)g(traf\256c)h(control.)
21 b(All)13 b(multi-service)f(actions)0 437 y(are)g(controlled)e(by)g(the)h
(emulation)f(library)m(.)0 601 y fe(Mach-US:)i(Flexibility)e(Through)i(Design)
45 b fd(The)11 b(biggest)f(single)h(feature)h(of)g(Mach-US)g(is)f(its)g(\257e\
xibility)-5 b(.)18 b(It)12 b(of)o(fers)0 657 y(a)g(whole)e(new)m(,)h(highly)f
(modi\256able)h(OS)g(architecture)g(without)e(signi\256cant)h(structural)g
(impediments)h(to)f(speed.)0 821 y fe(Object-Oriented)j(Generic)f(OS)f(Interf\
aces)46 b fd(There)10 b(are)h(a)g(series)f(C++)g(based)g(object-oriented)f
(interfaces)h(\(virtual)0 878 y(classes/methods)17 b(for)h(multiple)f(inherit\
ance\))h(that)g(de\256ne)h(semantics)f(supplied)f(by)h(the)g(system)g(servers\
.)38 b(These)0 934 y(interfaces)16 b(are:)26 b(access)16 b(mediation,)g(namin\
g,)h(I/O,)g(net)r 14 2 v 13 w(control\(OSI-XTI)f(based\),)h(and)f(async)f(not\
i\256cation.)29 b(The)0 991 y(various)9 b(servers)g(then)g(support)f(a)i(comb\
ination)f(of)g(these)g(interfaces)h(to)f(do)g(their)h(work)f(and)g(an)h(emula\
tion)f(library)g(uses)0 1047 y(them)i(to)g(emulate)g(the)g(tar)o(get)g(OS)h
(in)e(question.)62 1145 y(This)f(uniformity)g(of)h(access)h(makes)f(it)g(easy)
g(for)g(new)g(servers)g(to)g(supply)f(additional)f(functionality)f(by)j(slidi\
ng)e(into)0 1202 y(the)15 b(name-space)h(under)f(the)g(known)g(interfaces.)29
b(Then)15 b(that)f(functionality)f(is)i(generally)g(available)g(to)f(the)i
(system)0 1258 y(users)11 b(through)f(their)g(pre-existing)g(software.)0 1422
y fe(Modular)g(Services)46 b fd(Dif)o(ferent)10 b(functionality)e(is)j(separa\
ted)f(into)f(various)h(servers:)15 b(con\256guration,)10 b(authentication,)0
1479 y(path-name,)15 b(diagnostic,)e(pipenet,)h(ufs,)h(process-mgr)n(,)h(tty)
l(,)f(and)f(network)f(\(with)g(a)i(University)d(of)i(Arizona)f(xKernel)0 1535
y(protocol)e(engine\).)20 b(This)12 b(separation)f(makes)i(makes)g(it)e(simpl\
e)h(to)g(develop)g(and)g(debug)g(OS)h(services.)20 b(One)12 b(can)h(also)0
1592 y(add)e(and)f(subtract)g(services)h(as)g(needed)g(for)g(a)g(given)f(invo\
cation)f(of)i(the)g(system.)16 b(Furthermore,)11 b(a)h(bug)e(in)g(one)h(servi\
ce)0 1648 y(doesn')n(t)g(crash)h(or)f(corrupt)f(the)h(entire)g(system.)0 1812
y fe(Object)i(Library/Code)f(Reuse)45 b fd(There)12 b(is)f(an)h(extensive)e
(object)h(library)g(both)g(for)h(support/implementation)c(of)j(the)0 1869 y
(various)16 b(generic)h(interfaces)f(as)h(well)f(as)h(general)g(server)g(buil\
ding)e(blocks.)32 b(This)16 b(enables)g(faster)h(prototyping)d(of)0 1925 y
(a)i(new)g(server)g(and)g(eases)g(creation)f(of)h(servers)g(from)g(foreign)f
(code.)31 b(Some)17 b(high-lights)c(of)j(this)e(are)j(support)d(for:)0 1982 y
(name-space)d(manipulation,)e(protection,)h(mapped-\256les/shared-mem/pager)n
(-objects,)h(IO/bulk-data,)e(and)h(extensive)0 2038 y(event/interrupt/signal)
d(support.)0 2202 y fe(Mor)o(e)i(Mach-US)h(Information)45 b fd(Many)9 b(docum\
ents)f(containing)g(more)h(information)f(about)g(various)h(aspects)f(of)h(thi\
s)0 2259 y(system)i(are)g(described)g(in)g(the)g(.../doc/README)g(\256le)g
(in)g(the)g(source)g(directory)f(of)i(this)e(system.)0 2428 y fe(3.)46 b(T)l
(erms)0 2573 y fd(There)13 b(are)h(many)f(terms)g(that)g(are)h(thrown)e(aroun\
d)g(in)h(this)f(document.)21 b(T)m(o)13 b(keep)g(the)g(reader)h(from)f(being)
f(thrown)g(by)0 2629 y(them,)f(here)h(are)f(some)g(de\256nitions.)k(Many)c
(de\256nitions)e(that)i(are)g(mostly)f(common)h(to)g(OS)g(research)h(are)f
(not)f(supplied.)885 2804 y fc(DRAFT)m(-2)p eop
%%Page: 3 3
 bop 68 42 a fb(\017)23 b fd(OSItem:)16 b(An)11 b(formal)h(item)f(that)f(OSs)
h(normally)g(support:)j(task,)d(\256les,)h(pipes,)e(ttys,)h(...)68 135 y fb
(\017)23 b fd(Binding:)c(A)13 b(binding)f(is)h(a)h(logical)e(relationship)f
(set)j(up)f(between)g(a)h(client)f(and)g(an)g(OSItem)i(when)e(the)g(client)
114 192 y(receives)d(access)h(to)f(the)g(item.)16 b(\(eg.)h(When)10 b(a)g(cli\
ent)g(\252opens\272)g(a)h(\256le,)g(a)g(new)f(binding)e(is)i(created)h(that)f
(represents)114 248 y(the)h(conditions)d(of)k(the)e(open.\))68 342 y fb(\017)
23 b fd(Proxy:)i(An)15 b(object)h(in)f(a)h(client')m(s)g(address)f(space)h
(which)g(represents)f(an)h(object)f(in)h(another)f(address)h(space.)114 398 y
(A)e(client)f(side)h(representation)f(of)h(a)h(binding.)23 b(A)14 b(proxy)g
(may)h(also)e(directly)g(supply)g(some)h(of)h(the)f(semantics)114 455 y(assoc\
iated)c(with)g(its)g(OSItem.)68 549 y fb(\017)23 b fd(Agent:)15 b(A)c(protect\
ion)f(object)g(in)h(a)g(server)r(')n(s)g(address)f(space.)17 b(A)11 b(server)
h(side)e(representation)g(of)h(a)h(binding.)68 642 y fb(\017)23 b fd(Agency:)
f(Server)15 b(part)g(of)f(an)h(externally)e(accessable)i(OSItem)g(that)f(is)g
(represented)g(by)g(agent\(s\).)27 b(For)14 b(more)114 699 y(information)7 b
(on)i(bindings,)f(proxies,)g(agents,)h(and)g(agencies,)h(see)f(the)f(document)
h(entitled)e("Client)h(Server)i(Inter-)114 755 y(actions)e(in)g(Multi-Server)
h(Operating)f(Systems::)15 b(The)9 b(Mach-US)h(approach")e(in)h(the)f(\256le)
i(\252us)r 14 2 v 14 w(client)q 14 2 v 14 w(server)n(.ps\272.)68 849 y fb(\
\017)23 b fd(Interface)10 b(Class:)15 b(An)10 b(abstract)g(C++)g(class)f(with)
g(method)h(signatures)e(but)i(no)f(method)h(implementations.)k(Used)114 905 y
(to)c(formally)h(declare)h(an)f(interface)g(to)g(be)g(inherited)f(by)h(severa\
l)g(other)g(classes.)68 999 y fb(\017)23 b fd(Implementation)17 b(Class:)31 b
(A)19 b(C++)g(class)f(which)g(has)h(method)f(implementations)f(associated)h
(with)f(it.)39 b(An)114 1056 y(implementation)14 b(class)i(may)g(be)g(used)f
(to)h(associate)f(implementations)f(with)h(the)h(methods)f(described)g(in)h
(an)114 1112 y(abstract)10 b(class,)h(or)h(it)e(may)i(supply)e(unique)g(metho\
ds.)68 1206 y fb(\017)23 b fd(Base)d(Class:)32 b(A)20 b(class)f(used)g(to)g
(supply)f(a)i(partial)f(implementation)f(to)i(be)f(inherited)g(by)g(several)h
(similar)114 1262 y(implementation)9 b(classes.)0 1431 y fe(4.)46 b(Include)
11 b(Files)g(and)g(Interfaces)0 1576 y(4.1.)46 b(Service)11 b(Interfaces)0
1705 y fd(The)d(src)h(directory)e(.../include)h(contains)f(all)h(of)h(the)f
(service)g(interfaces)g(that)g(de\256ne)h(the)f(\252externally\272)f(visible)
g(interfaces)0 1761 y(to)15 b(the)f(system)h(servers)g(that)f(make)i(up)f(Mac\
h-US.)h(Each)f(server)h(supports)d(several)i(of)g(these)g(generic)g(API)g(gen\
eral)0 1818 y(interfaces)g(in)h(order)f(to)g(of)o(fer)i(the)e(functionality)e
(desired.)29 b(The)15 b(emulation)g(library)g(then)g(uses)g(these)g(interface\
s)h(to)0 1874 y(do)h(its)f(work.)35 b(These)16 b(interfaces)i(are)f(represent\
ed)g(by)g(abstract)g(classes)g(found)f(in)h(the)g(\256les)g(named)h(\252us)r
14 2 v 14 w(*)r 14 2 v 14 w(ifc.h\272)0 1931 y(\(mach-US)t 14 2 v 13 w(*)s 14
2 v 13 w(InterFaCe.H\).)13 b(These)e(interfaces)g(are)h(inherited)e(by)h(both)
f(proxy)g(and)h(implementation)f(classes.)0 2095 y fe(Ar)o(chitectur)q(e)h
(Classes/Interfaces)68 2230 y fb(\017)23 b fd(top)q 14 2 v 14 w(ifc.h)17 b
(/)f(usClass,)h(usT)l(op,)g(usRemote:)26 b(This)16 b(\256le)g(with)f(these)h
(three)h(classes)e(and)h(the)g(associated)g fc(Class-)114 2286 y(Helper)11 b
fd(macros)h(are)g(the)f(basis)g(for)h(the)f(object)g(architecture)g(in)g(Mach\
-US.)i(These)f(helper)f(macros)h(are)g(used)g(in)114 2343 y(the)d(class)g(dec\
laration)g(process)g(and)h(are)g(described)f(in)g(detail)g(in)h(the)f(documen\
t)g(in)g(the)h(\256le)g(\252libus-ref-1192.ps\272)114 2399 y(titled)f(\252Lib\
us++)h(Reference)i(Manual\272)g(by)f(Paulo)g(Guedes.)114 2474 y(The)16 b(usT)
l(op)g(class)g(is)h(inherited)e(\(directly)h(or)g(indirectly\))f(by)i(all)f
(classes)g(in)g(the)g(system,)i(and)f(supports)d(the)114 2531 y(reference)k
(counting)d(and)h(uses)h(the)f(usClass)g(class)h(to)f(support)f(class)i(info)
f(queries.)33 b(usRemote)17 b(is)f(used)h(to)114 2587 y(support)11 b(remote)j
(reference)g(and)f(invocation)f(of)h(objects.)22 b(A)13 b(description)e(of)j
(this)e(remote)h(invocation)f(system)114 2644 y(can)d(be)h(found)e(in)h(the)g
(document)g(entitled)e("Client)i(Server)h(Interactions)e(in)h(Multi-Server)g
(Operating)f(Systems::)114 2700 y(The)j(Mach-US)h(approach")e(in)h(the)g(\256\
le)g(\252us)s 14 2 v 13 w(client)r 14 2 v 14 w(server)m(.ps\272.)885 2804 y fc
(DRAFT)m(-3)p eop
%%Page: 4 4
 bop 114 42 a fd(T)l(op)r 14 2 v 14 w(ifc.h)11 b(is)f(also)f(the)i(repository)
e(for)h(central)g(build)f(information)h(and)g(system)g(wide)g(compile)g(time)
g(constants.)114 98 y(The)18 b(most)h(notable)f(of)h(these)g(are)g(the)g(\252\
GXX\272)g(constants)e(used)i(to)f(describe)h(workarounds)e(for)i(compiler)114
154 y(problems/bugs.)68 248 y fb(\017)k fd(us)r 14 2 v 13 w(item)s 14 2 v 14 w
(ifc.h)13 b(/)f(usItem:)19 b(This)12 b(class)g(inherits)g(from)h(usRemote)g
(and)g(adds)f(access)h(control)f(logic.)20 b(This)12 b(is)g(the)114 305 y(gre\
atest)i(common)g(ancestor)g(of)h(all)f(proxy)l(,)i(agent,)f(and)f(agency)h
(classes)f(and)g(is)g(thus)f(generally)h(used)g(as)g(the)114 361 y(C++)d(type)
f(of)h(object)g(ar)o(guments)g(in)g(the)f(following)g(interfaces.)68 455 y fb
(\017)23 b fd(method)r 14 2 v 13 w(info)r 14 2 v 14 w(ifc.h,class)r 14 2 v 14
w(info)r 14 2 v 14 w(ifc.h:)e(Interfaces)15 b(used)e(by)h(top)r 14 2 v 13 w
(ifc.h)g(as)g(part)g(of)g(the)g(remote)g(object)f(runtime)114 511 y(system.)0
676 y fe(Naming)i(Interface)46 b fd(One)16 b(aspect)g(of)g(Mach-US)h(is)e(tha\
t)g(all)h(of)g(the)g(OSItems)g(in)f(the)h(system)f(are)i(accessible)e(via)0
732 y(standard)e(path)h(resolution)e(in)i(the)g(name)h(space.)26 b(Each)15 b
(server)f(that)g(supplies)e(OSItems)j(maintains)e(a)i(sub-directory)0 788 y
(\252path)r 14 2 v 14 w(name\272)h(server)f(found)f(in)h(\252/server)r(\272.)
28 b(Further)15 b(subdirectories)f(are)h(maintained)g(at)g(the)g(desire)f(of)
h(the)g(server)o(,)0 845 y(and)f(there)h(are)g(mechanisms)g(to)f(cause)h(\252\
volatile\272)e(OSItems)i(to)f(disappear)g(automatically)l(.)27 b(A)15 b(discu\
ssion)d(of)i(these)0 901 y(temporary/volatile)9 b(object)i(can)g(be)g(found)g
(in)f(the)h(section)g fe(??)k fd(\252Class/Object)10 b(Semantics/Control\272.)
68 1037 y fb(\017)23 b fd(us)r 14 2 v 13 w(name)t 14 2 v 13 w(ifc.h)16 b(/)f
(usName:)24 b(Represents)15 b(a)h(directory)l(,)h(and)e(is)g(used)g(for)h(add\
ing/deleting/renaming)11 b(entries,)114 1093 y(listing,)e(creating)i(links,)f
(and)h(resolving)e(paths.)68 1187 y fb(\017)23 b fd(ns)r 14 2 v 13 w(types.h:)
h(Non-class)14 b(types/structures/enumerated-types)e(needed)j(by)g(the)h(nami\
ng)e(interface.)30 b(This)14 b(in-)114 1243 y(cludes)8 b(the)i(naming)f(servi\
ces)g fc(ns)r 14 2 v 14 w(type)r 14 2 v 14 w(t)g fd(type)g(and)g(the)g(associ\
ated)g fc(NST)s 14 2 v 14 w(*)g fd(enumerated)h(type)f(used)g(to)g(describes)
114 1300 y(the)i(\257avor)g(of)g(the)g(OSItems)h(returned)e(by)h(the)g(interf\
ace.)0 1435 y(See)h(section)e fe(??)16 b fd(on)11 b(\252Naming)g(and)g(Name)h
(Spaces\272)f(for)h(more)g(info.)0 1599 y fe(IO)h(Interface)46 b fd(This)11 b
(general)i(IO)f(interface)h(is)f(supported)f(by)h(all)g(servers)g(that)g(do)g
(IO.)h(These)f(include)g(ufs,)h(tty)l(,)g(net,)0 1656 y(and)e(pipenet.)16 b
(Interfaces)11 b(are)h(supplied)d(for)j(byte)e(and)h(record)h(IO.)68 1791 y fb
(\017)23 b fd(us)r 14 2 v 13 w(byteio)r 14 2 v 13 w(ifc.h)8 b(/)g(usByteIO:)e
(Standard)i(IO)g(for)f(read,)j(write,)e(append,)g(size,)h(as)e(well)g(as)h
(mapping)f(and)h(sequential)114 1848 y(access.)68 1941 y fb(\017)23 b fd(us)r
14 2 v 13 w(recio)s 14 2 v 14 w(ifc.h)11 b(/)g(usRecIO:)g(Simple/Minimal)f
(record)i(manipulation)68 2035 y fb(\017)23 b fd(io)r 14 2 v 13 w(types.h)11 b
(General)g(types/constants)d(needed)j(for)h(these)e(interfaces.)68 2129 y fb
(\017)23 b fd(io)r 14 2 v 13 w(types2.h)17 b(More)h(complex)f(record)h(manipu\
lation)d(types.)35 b(Useful)16 b(for)i(handling)e(more)i(complex)f(record)114
2185 y(manipulation.)34 b(An)17 b(implementation)f(class)h(interface)h(for)g
(this)e(complex)h(manipulation)f(can)i(be)g(found)f(in)114 2242 y(.../lib/us+\
+/iobuf)o 14 2 v 14 w(mgr)s 14 2 v 13 w(ifc.h.)32 b(This)16 b(interface)g(has)
g(not)g(been)g(exported)g(as)g(an)g(abstract)g(class)g(because)g(the)114 2298
y(simplicity)d(of)i(the)g(UNIX)g(io)g(model)g(has)g(not)f(required)h(it.)28 b
(For)16 b(more)f(complex)g(IO)h(models,)g(this)e(interface)114 2355 y(should)
9 b(be)i(exported.)0 2519 y fe(Network)i(Style)f(Interfaces)46 b fd(These)12 b
(interfaces)g(are)h(used)f(to)g(support)f(network)g(style,)h(endpoint)f(based)
h(communi-)0 2575 y(cations.)17 b(They)11 b(are)h(used)f(by)g(the)g(net)h(ser\
ver)f(to)g(supply)f(communication)h(with)f(remote)i(systems,)f(and)h(by)f(the)
g(pipenet)0 2632 y(server)h(for)g(to)f(support)f(emulation)g(of)i(intra-machi\
ne)f(communications)f(\(pipes,unix)g(sockets\).)17 b(This)11 b(network)f(inte\
r-)0 2688 y(face)i(is)f(based)g(upon)f(the)h(ISO)g(OSI/XTI)g(standard.)16 b
(This)10 b(is)h(embodied)g(in)f(the)h(following)e(abstract)i(classes)885 2804
y fc(DRAFT)m(-4)p eop
%%Page: 5 5
 bop 68 42 a fb(\017)23 b fd(us)r 14 2 v 13 w(net)s 14 2 v 13 w(base)s 14 2 v
13 w(ifc.h)12 b(/)f(usNetBase:)k(Base)d(end-point)e(type)68 135 y fb(\017)23 b
fd(us)r 14 2 v 13 w(net)s 14 2 v 13 w(name)s 14 2 v 14 w(ifc.h)12 b(/)f(usNet\
Name:)k(Named)d(endpoints)68 229 y fb(\017)23 b fd(us)r 14 2 v 13 w(net)s 14 2
v 13 w(connector)r 14 2 v 14 w(ifc.h)11 b(/)g(usNetConnector:)k(Unconnected)
10 b(endpoints.)68 323 y fb(\017)23 b fd(us)r 14 2 v 13 w(net)s 14 2 v 13 w
(clts)r 14 2 v 14 w(ifc.h)8 b(/)g(usNetCL)-5 b(TS:)9 b(ConnectionLess)d(T)n
(ransport)h(Service)i(endpoints.)14 b(\(May)9 b(be)f(meta-connected)114 379 y
(with)i(a)h(default)g(remote)h(tar)o(get\))68 473 y fb(\017)23 b fd(us)r 14 2
v 13 w(net)s 14 2 v 13 w(clts)r 14 2 v 14 w(recs)s 14 2 v 13 w(ifc.h)12 b(/)f
(usNetCL)-5 b(TS)r 14 2 v 14 w(recs:)16 b(CL)l(TS)c(endpoints)d(with)h(full)g
(record)i(manipulation)d(\(eg.)17 b(UDP\).)68 567 y fb(\017)23 b fd(us)r 14 2
v 13 w(net)s 14 2 v 13 w(cots)r 14 2 v 14 w(ifc.h)8 b(/)g(usNetCOTS:)f(Connec\
tion)f(Oriented)h(T)n(ransport)g(Service)i(endpoints,)e(or)g(one)h(could)f
(simply)114 623 y(call)k(them)g(connections.)68 717 y fb(\017)23 b fd(us)r 14
2 v 13 w(net)s 14 2 v 13 w(cots)r 14 2 v 14 w(bytes)r 14 2 v 13 w(ifc.h)12 b
(/)f(usNetCOTS)r 14 2 v 13 w(bytes:)k(Connections)10 b(with)g(byte)h(IO)g(\(e\
g.)17 b(pipes\).)68 811 y fb(\017)23 b fd(us)r 14 2 v 13 w(net)s 14 2 v 13 w
(cots)r 14 2 v 14 w(recs)s 14 2 v 13 w(ifc.h)12 b(/)f(usNetCOTS)r 14 2 v 13 w
(recs:)17 b(Connections)9 b(with)h(record)i(IO)f(\(eg.)17 b(TCP\).)68 905 y fb
(\017)23 b fd(net)r 14 2 v 14 w(types.h:)15 b(Further)c(types)f(for)h(support\
ing)e(the)i(above.)0 1069 y fe(T)l(ask)18 b(Master)g(Interfaces)46 b fd(While)
18 b(the)g(taskmaster)g(itself)f(is)h(speci\256c)g(to)g(UNIX)g(because)g(of)g
(certain)g(semantic)0 1126 y(constraints,)9 b(these)i(interfaces)g(are)g(not)
f(believed)h(to)f(be.)17 b(They)10 b(are)i(used)e(to)g(track)h(the)g(process)
r 14 2 v 14 w(id)f(name-space)i(and)f(to)0 1182 y(support)f(posting)f(of)i
(system)g(events)f(to)h(user)g(processes)g(\(eg.)16 b(signalling\).)68 1317 y
fb(\017)23 b fd(us)r 14 2 v 13 w(tm)s 14 2 v 14 w(root)r 14 2 v 13 w(ifc.h)12
b(/)f(usTMRoot:)16 b(Base)c(connection)e(for)h(general)h(queries)e(and)i(crea\
tions)e(of)i(the)f(other)g(objects.)114 1374 y(Only)f(one)h(usTMRoot)f(object)
h(exists)f(per)h(emulated)g(API.)68 1468 y fb(\017)23 b fd(us)r 14 2 v 13 w
(tm)s 14 2 v 14 w(task)r 14 2 v 13 w(ifc.h)14 b(/)g(usTMT)l(ask:)21 b(Represe\
nts)14 b(an)g(individual)d(task.)24 b(Supports)13 b(manipulation)f(of)i(its:)
20 b(id,)15 b(task)114 1524 y(group,)10 b(status,)h(timers,)g(and)g(posting)e
(of)i(events.)68 1618 y fb(\017)23 b fd(us)r 14 2 v 13 w(tm)s 14 2 v 14 w(tgr\
p)r 14 2 v 13 w(ifc.h)11 b(/usTMTgrp:)j(T)l(ask)c(group)g(class)f(supports)g
(task)g(group)h(id)f(queries)h(and)g(posting)e(of)i(events)g(to)114 1674 y
(a)h(group.)68 1768 y fb(\017)23 b fd(timer)m(.h:)16 b(T)m(ypes)10 b(for)i
(setting)d(task)i(timers.)68 1862 y fb(\017)23 b fd(tm)r 14 2 v 14 w(types.h:)
15 b(General)c(types)g(needed)g(for)g(the)g(above)g(interfaces.)68 1956 y fb
(\017)23 b fd(us)r 14 2 v 13 w(event)s 14 2 v 13 w(ifc.h)13 b(/)g(usEvent:)k
(Event)12 b(object)g(exported)g(by)g(emulated)h(user)f(process,)h(not)f(the)h
(task)q 14 2 v 14 w(master)n(.)21 b(This)114 2012 y(interface)14 b(is)g(used)
f(by)h(the)g(task)g(master)g(to)g(post)f(events)g(\(send)h(signals\))f(to)h
(the)g(emulated)g(process,)g(so)g(that)g(it)114 2069 y(may)d(interpret)g(the)
g(event)f(based)h(upon)f(its)h(own)f(state)h(\(sigmask,...\).)0 2233 y fe(Spe\
cialized)h(Abstract)f(Classes)68 2368 y fb(\017)23 b fd(us)r 14 2 v 13 w(tty)
r 14 2 v 14 w(ifc.h,)12 b(usTTY:)d(Byte)j(IO)f(with)f(ioctl)g(added.)68 2462 y
fb(\017)23 b fd(clone)r 14 2 v 13 w(ifc.h,)18 b(usClone:)24 b(Interface)16 b
(used)g(in)f(object)g(forking.)29 b(All)15 b(objects)g(used)g(in)g(the)h(emul\
ation)f(lib)f(must)114 2518 y(support)9 b(this)h(class.)17 b(See)12 b(section)
e fe(??)16 b fd(on)10 b(\252Forking\272)h(below)f(for)i(more)g(info.)885 2804
y fc(DRAFT)m(-5)p eop
%%Page: 6 6
 bop 0 42 a fe(Error)10 b(De\256nitions)45 b fd(These)9 b(\256les)h(contain)f
(error)h(values)f(of)h(type)f fc(mach)r 14 2 v 14 w(err)n(or)r 14 2 v 14 w
(t)g fd(for)h(well)g(known)e(system)h(errors.)17 b(All)0 98 y(external)10 b
(interface)g(methods)f(and)h(most)g(internal)f(ones)h(in)f(the)h(system)g(hav\
e)g(a)g(return)g(type)g(of)g(mach)s 14 2 v 13 w(error)t 14 2 v 13 w(t)g(to)g
(handle)0 154 y(normal)h(communication)f(of)i(error)f(conditions.)68 290 y fb
(\017)23 b fd(us)r 14 2 v 13 w(error)n(.h:)16 b(General)c(Mach-US)g(errors.)
68 384 y fb(\017)23 b fd(mach)s 14 2 v 13 w(object)r 14 2 v 14 w(error)n(.h:)
16 b(Object)10 b(system)h(errors.)68 477 y fb(\017)23 b fd(exception)q 14 2 v
14 w(error)n(.h:)16 b(Mach)c(kernel)e(exceptions)g(as)h(errors.)68 571 y fb
(\017)23 b fd(ns)r 14 2 v 13 w(error)n(.h:)16 b(Name)c(Space)g(errors.)68 665
y fb(\017)23 b fd(io)r 14 2 v 13 w(error)n(.h:)16 b(IO)c(errors.)68 759 y fb
(\017)23 b fd(net)r 14 2 v 14 w(error)m(.h:)16 b(Network)11 b(errors.)68 853 y
fb(\017)23 b fd(sig)q 14 2 v 14 w(error)n(.h:)16 b(Unix)10 b(signals)g(as)h
(mach)s 14 2 v 14 w(error)s 14 2 v 14 w(t)g(values.)0 1017 y fe(Other)h(Mixed)
g(Interfaces)45 b fd(The)11 b(following)f(are)h(non-class)f(interfaces:)68
1152 y fb(\017)23 b fd(interrupt.h:)13 b(De\256nitions)6 b(and)h(interface)h
(for)g(Mach-US)g(interrupt)f(support.)14 b(All)7 b(system)g(servers)h(and)f
(emulation)114 1209 y(lib)15 b(code)h(must)g(be)g(aware)h(of)g(the)f(need)g
(to)g(handle)f(interrupts.)30 b(For)17 b(more)g(info,)g(see)g(the)f(note)f
(\252interrupts-)114 1265 y(0791.note\272.)68 1359 y fb(\017)23 b fd(base.h:)
16 b(General)11 b(system)f(wide)h(macros)h(\(NULL,)f(TRUE,...\))68 1453 y fb
(\017)23 b fd(auth)r 14 2 v 13 w(defs.h:)16 b(Authentication)9 b(system)h(con\
stants)g(and)h(error)h(values.)68 1546 y fb(\017)23 b fd(diag)r 14 2 v 13 w
(defs.h:)16 b(Diagnostic)9 b(server)j(msg)f(type.)68 1640 y fb(\017)23 b fd
(syscall)q 14 2 v 14 w(val.h:)15 b(Syscall)c(return)g(value)g(structure.)0
1804 y fe(4.2.)46 b(Other)12 b(Include)g(Dir)o(ectories)0 1933 y fd(These)f
(other)g(include)f(directories)g(are)i(also)f(found)f(at)h(the)g(top)f(level)
h(in)g(the)g(source)g(tree.)68 2068 y fb(\017)23 b fd(local)r 14 2 v 13 w(inc\
ludes:)e(include)13 b(\256les)i(common)f(to)g(multiple)f(servers/libs)f(but)i
(not)f(needed)i(by)e(users)h(or)h(emul)r 14 2 v 14 w(libs.)114 2125 y(Separat\
ion)10 b(of)i(this)e(directory)g(from)i(.../include)f(and)g(.../lib/us++/*.h)
e(was)i(never)g(very)g(clear)n(.)68 2219 y fb(\017)23 b fd(mach)s 14 2 v 13 w
(include)r 14 2 v 14 w(sa:)c(a)13 b(frozen)h(copy)e(of)h(the)g(Mach)g(kernel)
g(include)f(\256les.)22 b(Periodically)12 b(regenerated)h(from)g(the)114 2275
y(real)e(kernel)g(sources.)68 2369 y fb(\017)23 b fd(sa)r 14 2 v 14 w(include\
:)15 b(a)c(few)h(\256les)f(that)f(override)h(the)g(\256les)g(in)g(./mach)s 14
2 v 14 w(include)q 14 2 v 14 w(sa,)h(to)e(correct)i(problems)e(and)h(defects.)
68 2463 y fb(\017)23 b fd(unix)q 14 2 v 14 w(include:)15 b(a)c(frozen)h(copy)
e(of)i(UNIX)f(include)f(\256les,)h(for)h(the)f(UNIX)f(system)h(that)g(we)g
(are)h(emulating.)885 2804 y fc(DRAFT)m(-6)p eop
%%Page: 7 7
 bop 0 42 a fe(5.)46 b(General)11 b(Libraries)0 186 y(5.1.)46 b(Short)12 b
(Summary)f(Of)h(System)f(Libs)68 292 y fb(\017)23 b fd(C++:)17 b(This)11 b
(library)g(replaces)h(parts)g(of)g(the)g(g++)f(runtime)g(system)h(to)f(\256x)
h(some)h(problems)e(with)g(object)g(alloca-)114 348 y(tion/deallocation)d(and)
j(initialization.)68 441 y fb(\017)23 b fd(Mach3:)32 b(a)20 b(collection)d
(of)j(libraries)e(for)h(basic)g(functions)f(needed)h(by)g(most)g(Mach)h(progr\
ams.)40 b(Roughly)114 498 y(equivalent)9 b(to)i(a)h(combination)d(of)i(libmac\
h.a)h(and)f(libc.a)g(from)h(the)f(common)g(release)h(areas.)68 591 y fb(\017)
23 b fd(Threads:)15 b(Modi\256ed)10 b(version)g(of)h(the)f(cthreads)g(library)
l(,)i(for)e(use)h(inside)e(the)i(US)f(emulation)g(library)l(.)17 b(Unlike)9 b
(the)114 647 y(default)h(threads)h(package,)g(there)g(is)g(a)h(one-to-one)e
(mapping)g(between)h(cthreads)g(and)g(kernel)f(threads)h(with)f(this)114 704 y
(package.)68 797 y fb(\017)23 b fd(Proxies:)15 b(Library)10 b(which)g(contain\
s)f(all)h(of)h(the)f(automatically)f(constructed)h(default)g(proxies,)g(and)g
(any)h(special-)114 854 y(ized)g(proxies.)18 b(These)11 b(proxies)g(are)i(lat\
er)e(linked)g(into)g(the)g(emulation)g(lib.)17 b(This)11 b(libproxies)f(is)h
(very)h(dependent)114 910 y(upon)e(libus++)f(and)i(was)g(at)g(one)g(point)f
(part)h(of)g(that)g(lib.)68 1003 y fb(\017)23 b fd(Us++:)15 b(Main)d(reposito\
ry)e(for)i(classes)f(and)h(common)g(functions)e(in)h(the)g(whole)g(Mach-US)i
(system.)k(Should)11 b(be)114 1060 y(lar)o(gely)f(generic,)i(and)f(not)f(depe\
ndent)h(on)f(UNIX)h(semantics.)16 b(More)c(detail)f(in)f(following)f(paragrap\
h.)68 1153 y fb(\017)23 b fd(Ux:)e(Support)13 b(classes)h(and)g(functions)e
(for)j(the)f(implementation)e(of)i(UNIX-like)g(emulation)f(libraries.)24 b
(More)114 1209 y(detail)10 b(in)h(following)e(paragraph.)0 1373 y fe(5.2.)46 b
(The)12 b(Us++)e(library)0 1502 y fd(This)g(library)f(is)i(where)f(all)h(of)f
(the)g(implementation)g(classes)g(and)g(general)g(software)h(used)f(by)g(mult\
iple)f(servers)i(and/or)0 1558 y(the)h(emulation)g(lib)g(live.)20 b(Amongst)
11 b(other)h(things,)g(these)g(classes)g(are)h(used)f(to)h(support)e(the)h
(various)g(abstract)g(classes)0 1614 y(found)f(in)h(the)g(\252.../include/us)
q 14 2 v 14 w(*)r 14 2 v 14 w(ifc.h\272)g(\256les.)19 b(These)12 b(\256les)g
(or)g(the)g(associated)f(\252.cc\272)i(\256les)f(may)h(have)f(more)g(extensiv\
e)0 1671 y(descriptions)d(of)i(parts)g(of)g(the)g(abstract)g(interfaces.)16 b
(Sometimes)11 b(the)g(oldest)f(\252.cc\272)i(\256le)g(for)f(any)g(given)f(int\
erface)i(is)e(the)0 1727 y(best)h(source)g(of)g(info.)16 b(Below)11 b(are)h
(some)f(of)g(the)g(facilities)f(available.)68 1873 y fb(\017)23 b fd(Implemen\
tation)10 b(Classes)h(for)g(the)g(Object)f(Architecture:)168 1966 y fe(\261)
23 b fd(agent)r 14 2 v 13 w(ifc.h:)17 b(representative)10 b(of)h(a)h(client)e
(for)h(a)h(given)e(object)h(within)e(a)j(server)m(.)168 2039 y fe(\261)23 b fd
(agency)r 14 2 v 14 w(ifc.h:)16 b(coordinator)10 b(of)h(agents)f(for)i(a)f
(given)g(externally)f(visible)f(server)j(object.)168 2111 y fe(\261)23 b fd
(vol)q 14 2 v 14 w(agency)s 14 2 v 13 w(ifc.h:)16 b(volatile)10 b(agency)m
(,)h(base)h(class)e(for)i(non-fs)e(OSItems.)168 2183 y fe(\261)23 b fd(tmp)r
14 2 v 14 w(agency)r 14 2 v 14 w(ifc.h:)j(vol)q 14 2 v 14 w(agency)16 b(that)
f(automatically)g(disappears)g(from)h(directories)f(when)h(no)g(longer)214
2240 y(referenced.)168 2312 y fe(\261)23 b fd(tmp)r 14 2 v 14 w(dir)r 14 2 v
14 w(ifc.h:)16 b(A)11 b(directory)f(that)h(disappears)f(when)h(it)g(goes)f
(empty)m(.)168 2385 y fe(\261)23 b fd(tmp)r 14 2 v 14 w(prop)r 14 2 v 13 w
(ifc.h:)16 b(Mechanism)c(for)f(giving)f(the)h(temporary)g(property)f(to)h(any)
g(agency)m(.)68 2478 y fb(\017)23 b fd(IO)10 b(buf)o(fering)g(objects:)15 b
(OSs)10 b(do)g(IO.)h(These)f(implementation)f(classes)h(supply)f(support)g
(for)i(streams/buf)n(fering.)168 2571 y fe(\261)23 b fd(iobuf)q 14 2 v 14 w
(user)r 14 2 v 14 w(ifc.h,default)r 14 2 v 14 w(iobuf)r 14 2 v 13 w(mgr)s 14 2
v 14 w(ifc.h:)28 b(Buf)o(fer)18 b(manager)f(veneer)o(,)i(and)e(default)f(buf)
o(fer)h(manager)214 2628 y(interface.)168 2700 y fe(\261)23 b fd(stream)s 14 2
v 13 w(base)s 14 2 v 13 w(ifc.h:)16 b(Base)c(classes)f(for)g(following)e(stre\
am)j(classes.)885 2804 y fc(DRAFT)m(-7)p eop
%%Page: 8 8
 bop 168 42 a fe(\261)23 b fd(bytestream)r 14 2 v 13 w(ifc.h:)17 b(Buf)o(fere\
d)12 b(byte)e(streams.)168 114 y fe(\261)23 b fd(recordstream)s 14 2 v 13 w
(ifc.h:)16 b(Buffered)11 b(record)h(streams)68 207 y fb(\017)23 b fd(Name)12 b
(Space)f(Objects:)168 301 y fe(\261)23 b fd(std)q 14 2 v 14 w(name)s 14 2 v 14
w(ifc.h:)i(Client)15 b(side)g(object)g(supplying)e(the)i(interface)h(to)f(the)
h(naming,)g(path)g(resolution)d(and)214 357 y(pre\256x)e(table)g(access.)168
430 y fe(\261)23 b fd(dir)r 14 2 v 13 w(ifc.h:)17 b(Directory)l(.)168 502 y fe
(\261)23 b fd(mountpt)q 14 2 v 14 w(ifc.h:)16 b(Connection)10 b(for)h(a)g(ser\
ver)h(into)e(a)i(directory)l(.)168 575 y fe(\261)23 b fd(symlink)q 14 2 v 13 w
(ifc.h:)17 b(A)11 b(symbolic)f(link.)168 647 y fe(\261)23 b fd(tsymlink)p 14 2
v 14 w(ifc.h:)d(A)13 b(transparent)f(symbolic)g(link.)21 b(Like)12 b(a)i(syml\
ink)d(but)h(is)h(always)f(followed)g(instead)g(of)214 704 y(showing)f(up)i
(as)g(a)h(symlink.)22 b(Used)12 b(for)i(making)f(a)g(Mach-US)i(normal)e(direc\
tory)f(structure)h(correspond)214 760 y(to)d(the)h(directory)g(structure)f
(of)h(a)h(speci\256c)f(API.)68 854 y fb(\017)23 b fd(Protection)10 b(Objects:)
168 947 y fe(\261)23 b fd(std)q 14 2 v 14 w(prot)r 14 2 v 14 w(ifc.h:)16 b
(Protection)10 b(for)h(a)h(given)e(OSItems,)i(like)f(the)f(protection)g(on)h
(a)h(\256le.)168 1019 y fe(\261)23 b fd(std)q 14 2 v 14 w(ident)r 14 2 v 13 w
(ifc.h:)16 b(A)c(user)f(identity)-5 b(,)11 b(like)g(an)g(unfor)o(geable)g(uid\
.)168 1092 y fe(\261)23 b fd(std)q 14 2 v 14 w(cred)s 14 2 v 14 w(ifc.h:)16 b
(A)10 b(list)g(of)h(credentials)e(to)i(describe)f(what)g(an)h(individual)e
(is)h(permitted.)16 b(Like)10 b(a)h(uid)f(and)h(a)214 1148 y(set)f(of)i(group)
e(ids.)168 1221 y fe(\261)23 b fd(std)q 14 2 v 14 w(auth)r 14 2 v 14 w(ifc.h:)
16 b(Interface)c(to)e(the)h(Authentication)e(Server)n(.)17 b(Used)10 b(to)h
(acquire)g(std)r 14 2 v 14 w(creds)g(and)g(std)r 14 2 v 13 w(idents.)168 1294
y fe(\261)23 b fd(access)r 14 2 v 14 w(table)r 14 2 v 14 w(ifc.h:)30 b(List)
17 b(of)h(permissions)f(required)h(for)g(each)h(externally)e(available)h(meth\
od)g(in)f(the)214 1350 y(system.)68 1443 y fb(\017)23 b fd(File)8 b(System)h
(Protection:)k(File)c(systems)e(need)i(a)g(slightly)d(dif)n(ferent/more)j(spe\
ci\256c)g(protection)e(implementation)114 1500 y(that)j(do)h(general)g(OSItem\
s.)17 b(These)11 b(\256les)g(contain)f(the)h(associated)f(implementation)g
(class)h(de\256nitions.)168 1593 y fe(\261)23 b fd(fs)r 14 2 v 14 w(access)s
14 2 v 13 w(ifc.h)168 1666 y fe(\261)g fd(fs)r 14 2 v 14 w(auth)r 14 2 v 13 w
(ifc.h)168 1738 y fe(\261)g fd(fs)r 14 2 v 14 w(cred)s 14 2 v 13 w(ifc.h)68
1831 y fb(\017)g fd(Mapped)12 b(Files)f(and)h(Pagers:)17 b(An)11 b(alternate)
h(data)g(communication)e(paradigm)i(in)f(Mach)i(is)e(the)h(external)f(pager)n
(.)114 1888 y(Mapped)i(\256les)g(and)h(shared)f(memory)h(are)g(handled)e(via)
h(this)f(paradigm.)23 b(These)13 b(objects)g(implement)f(the)i(non-)114 1944 y
(kernel)d(portion)e(of)i(said)g(interfaces.)168 2038 y fe(\261)23 b fd(pager)
r 14 2 v 14 w(base)r 14 2 v 14 w(ifc.h:)16 b(The)11 b(base)g(class)g(for)g
(other)g(external)g(pager)g(objects.)168 2110 y fe(\261)23 b fd(null)q 14 2 v
14 w(pager)r 14 2 v 14 w(ifc.h:)16 b(Pager)c(backed)f(up)g(by)g(mem,)h(used)f
(for)g(shared)g(memory)n(.)168 2183 y fe(\261)23 b fd(mf)s 14 2 v 13 w(mem)t
14 2 v 14 w(ifc.h:)16 b(Common)11 b(implementation)f(for)i(next)e(two)h(class\
es)168 2255 y fe(\261)23 b fd(mf)s 14 2 v 13 w(mgr)s 14 2 v 14 w(ifc.h:)16 b
(Server)c(side)f(support)e(for)j(a)f(mapped)h(\256le)168 2328 y fe(\261)23 b
fd(mf)s 14 2 v 13 w(user)s 14 2 v 14 w(ifc.h:)16 b(Client)10 b(side)h(for)g
(a)h(mapped)f(\256le)168 2400 y fe(\261)23 b fd(usint)q 14 2 v 13 w(mf)t 14 2
v 13 w(ifc.h,usint)r 14 2 v 13 w(m\256o)t 14 2 v 13 w(ifc.h:)16 b(IO)c(abstra\
ct)e(interface)i(veneer)f(for)h(mapped)f(\256les.)68 2494 y fb(\017)23 b fd
(VNode)11 b(Interface:)17 b(The)11 b(following)e(classes)i(supply)f(a)i(vnode)
f(implementation)f(to)h(be)g(used)g(with)g(pre-existing)114 2550 y(vnode)h
(\256le)i(servers,)h(supplying)c(external)i(interfaces)g(that)g(support)f(the)
h(Mach-US)i(abstract)e(interfaces.)23 b(This)114 2607 y(work)10 b(was)h(done)
g(by)g(Paul)g(Roy)g(at)g(the)g(OpenSoftwareFoundation.)168 2700 y fe(\261)23 b
fd(vn)r 14 2 v 13 w(agency)s 14 2 v 14 w(ifc.h:)885 2804 y fc(DRAFT)m(-8)p eop
%%Page: 9 9
 bop 168 42 a fe(\261)23 b fd(vn)r 14 2 v 13 w(dir)s 14 2 v 13 w(ifc.h:)168
115 y fe(\261)g fd(vn)r 14 2 v 13 w(\256le)s 14 2 v 14 w(ifc.h:)168 188 y fe
(\261)g fd(vn)r 14 2 v 13 w(mgr)s 14 2 v 14 w(ifc.h:)168 261 y fe(\261)g fd
(vn)r 14 2 v 13 w(pager)s 14 2 v 14 w(ifc.h:)168 334 y fe(\261)g fd(vn)r 14 2
v 13 w(symlink)r 14 2 v 13 w(ifc.h:)168 407 y fe(\261)g fd(vn)r 14 2 v 13 w
(tsymlink)q 14 2 v 14 w(ifc.h:)68 501 y fb(\017)g fd(Nets)10 b(and)h(Endpoint)
168 594 y fe(\261)23 b fd(net)r 14 2 v 14 w(dir)r 14 2 v 13 w(base)s 14 2 v 14
w(ifc.h:)16 b(Base)11 b(class)g(for)g(a)h(directory)e(of)i(endpoints)168 667 y
fe(\261)23 b fd(net)r 14 2 v 14 w(endpt)q 14 2 v 14 w(base)r 14 2 v 14 w(ifc.\
h:)16 b(Base)c(class)f(for)g(an)g(endpoint.)68 761 y fb(\017)23 b fd(Misc)168
855 y fe(\261)g fd(diag)r 14 2 v 13 w(ifc.h:)16 b(Interface)c(object)f(for)g
(accessing)g(the)f(diagnostic)g(server)h(\(console\).)168 928 y fe(\261)23 b
fd(rpcmgr)s 14 2 v 13 w(ifc.h:)16 b(Remote)c(method)f(invocation)e(runtime)i
(system)168 1001 y fe(\261)23 b fd(clone)r 14 2 v 13 w(master)s 14 2 v 14 w
(ifc.h:)i(Central)16 b(emulation)e(lib)h(only)g(object)g(for)h(registration)d
(of)j(object)f(for)h(cloning)e(at)214 1058 y(fork)d(time.)0 1222 y fe(5.3.)46
b(The)12 b(UX)f(library)0 1350 y fd(The)i(following)e(objects)h(supply)f(unix)
h(speci\256c)h(support)e(for)i(use)g(in)f(the)h(unix)f(emulation)g(lib.)21 b
(The)13 b(objects)e(are)j(only)0 1407 y(used)d(by)f(the)h(emulation)g(lib,)f
(and)h(support)f(unix)g(OSItems)i(that)e(exist)g(in)h(the)g(emul)s 14 2 v 13 w
(lib)g(and)g(not)f(elsewhere.)68 1542 y fb(\017)23 b fd(uxident)q 14 2 v 13 w
(ifc.h:)16 b(unix)11 b(user)g(identity)-5 b(.)68 1636 y fb(\017)23 b fd(uxio)
q 14 2 v 14 w(ifc.h:)16 b(Base)c(class)e(for)i(unix)e(io)h(object)f(to)h(be)g
(found)f(in)h(\256le)h(discriptor)d(table.)68 1730 y fb(\017)23 b fd(uxio)q 14
2 v 14 w(pipe)r 14 2 v 13 w(ifc.h:)17 b(Pipe)11 b(object)68 1824 y fb(\017)23
b fd(uxio)q 14 2 v 14 w(socket)r 14 2 v 13 w(ifc.h:)16 b(socket)11 b(object)
68 1917 y fb(\017)23 b fd(uxio)q 14 2 v 14 w(tty)r 14 2 v 13 w(ifc.h:)16 b
(tty)11 b(object)68 2011 y fb(\017)23 b fd(uxselect)q 14 2 v 14 w(ifc.h:)18 b
(object)11 b(that)g(supports)g(pending)f(select)i(actions)f(on)h(an)g(uxio)f
(object.)18 b(Selects)12 b(are)h(done)f(with)f(a)114 2068 y(multi-thread)e
(implementation)g(that)h(does)f(read/write)h(of)h(type)e(\252IO)s 14 2 v 14 w
(PROBE\272,)i(tracks)g(what)e(these)h(probes)g(\256nd)114 2124 y(and)h(return\
s)f(the)h(info.)16 b(Be)c(careful)g(when)e(you)h(tread)g(here.)68 2218 y fb
(\017)23 b fd(uxsignal)p 14 2 v 14 w(ifc.h:)g(object)14 b(for)h(posting)e(and)
i(servicing)e(unix)h(signals)f(based)i(on)f(inter)o(-task)g(or)h(intra-task)e
(event)114 2274 y(postings.)68 2368 y fb(\017)23 b fd(uxstat)q 14 2 v 14 w
(ifc.h:)16 b(supplies)9 b(unix)h(\252stat\272)h(functionality)-6 b(.)68 2462 y
fb(\017)23 b fd(devnull)q 14 2 v 13 w(ifc.h:)16 b(specialized)11 b(dev)g(null)
f(object.)68 2556 y fb(\017)23 b fd(ftab)r 14 2 v 14 w(ifc.h:)16 b(unix)10 b
(descriptor)g(\256le)i(table.)885 2804 y fc(DRAFT)m(-9)p eop
%%Page: 10 10
 bop 0 42 a fe(6.)46 b(Server)12 b(Descriptions)0 186 y(6.1.)46 b(Authenticat\
ion)11 b(Server)0 315 y fd(The)j(authentication)d(server)j(is)f(used)h(to)f
(ensure)h(system)f(ID)h(security)l(.)24 b(It)14 b(is)f(the)h(of)o(\256cial)g
(owner)f(of)h(user)g(credentials)0 371 y(like)g(group)g(and)g(user)h(ids.)26 b
(The)15 b(server)g(work)f(itself)g(was)h(done)f(as)h(thesis)e(work)h(by)h(Rob\
ert)f(Sansom,)i(and)f(there)g(is)0 428 y(extensive)10 b(documentation)g(for)h
(it)g(with)f(the)h(sources.)62 526 y(Mach-US)d(has)f(a)g(distinctly)t(separat\
e)g(protection)e(model)i(than)f(that)h(of)g(UNIX.)g(It)f(uses)h(a)g(credentia\
ls)f(list)f(technology)l(,)0 582 y(with)h(the)i(\256rst)f(entry)g(being)g(the)
g(primary)h(identity)d(and)i(the)h(rest)f(being)g(other)g(groups)f(that)h(are)
h(permitted.)15 b(There)7 b(are)i(well)0 639 y(known)g(ids)g(found)h(in)g(the)
f(\252as)s 14 2 v 14 w(database\272)h(and)g(the)g(\252root\272)g(user)g(has)g
(the)g(ability)e(to)i(create)h(additional)d(ids)h(dynamically)0 695 y(to)18 b
(more)h(easily)f(accommodate)h(the)f(\252/etc/passwd,/bin/login\272)c(API.)20
b(This)d(server)i(supplies)d(no)j(OSItems)f(to)g(the)0 752 y(Mach-US)12 b(nam\
e)g(space,)g(but)e(instead)g(is)h(used)g(to)f(support)g(the)h(remote)g(object)
g(invocation)e(system.)0 916 y fe(6.2.)46 b(Con\256guration)11 b(Server)0 1044
y fd(This)e(server)i(is)e(used)h(to)g(start)f(the)h(various)g(system)f(server\
s.)16 b(It)11 b(executes)e(the)h(rc.us)h(script.)k(It)10 b(also)g(supports)e
(a)j(separate)0 1101 y(mach)17 b(port)f(names)h(space)g(\(aka)g(snames\))g
(for)g(the)f(Mach-US)i(system)e(\(see)h(section)f fe(??)32 b fd(on)16 b(\252N\
aming)h(and)f(Name)0 1157 y(Spaces\272)9 b(below\))g(Mechanisms)g(for)g(more)
g(dynamic)g(con\256guration)e(was)i(meant)g(to)g(go)f(here)i(but)e(time)h(has)
f(not)h(allowed.)0 1214 y(This)h(server)i(exports)e(no)h(OSItems)g(and)g(is)g
(used)f(purely)h(for)g(startup)f(support.)0 1378 y fe(6.3.)46 b(Diagnostic)10
b(Server)0 1506 y fd(This)16 b(server)h(serves)g(a)h(similar)e(rol)h(to)g(the)
f(console)h(of)g(a)g(standard)f(unix)g(system.)34 b(It)17 b(forwards)g(its)f
(output)g(to)g(the)0 1563 y(\252console\272)g(where)h(the)g(multi-server)f
(was)h(started.)33 b(The)16 b(various)g(\252ERROR\(\)\272)i(and)f(\252DEBUG[0\
-3]\272)g(statements)0 1619 y(sprinkled)10 b(through)f(out)i(the)g(system)f
(send)h(messages)g(to)g(this)f(server)m(.)0 1783 y fe(6.4.)46 b(Path)11 b(Nam\
e)g(Server)0 1912 y fd(This)i(simply)f(supplies)g(a)i(Mach-US)g(name)h(servic\
e)e(interface.)24 b(It)14 b(is)f(used)g(as)h(the)f(base)g(server)h(that)f(all)
g(of)h(the)f(other)0 1968 y(system)8 b(servers)g(mount)g(their)f(OSItem)i(dir\
ectories)e(in.)16 b(It)8 b(is)g(found)f(in)h(the)g(\252/server)q(\272)h(area)
g(of)f(the)g(UNIX)g(API)h(Mach-US)0 2025 y(name)j(space.)0 2189 y fe(6.5.)46 b
(Network)11 b(Server)0 2317 y fd(This)j(server)h(supplies)e(TCP/UDP/IP/ICMP/A\
RP/...)29 b(for)15 b(communication)e(with)h(the)h(outer)f(world.)27 b(The)14 b
(protocol)0 2374 y(engines)j(themselves)g(were)i(supplied)d(by)i(the)g(xKerne\
l)f(project)h(under)f(Larry)i(Peterson)e(from)i(the)f(University)e(of)0 2430 y
(Arizona.)29 b(As)15 b(part)g(of)g(this)f(project)h(it)g(was)g(ported)g(to)g
(the)g(i[34]86)f(architecture)h(and)g(set)g(of)g(\252xKernel)h(protocols\272)
0 2487 y(to)f(support)f(the)g(OSI/XTI)h(style)g(interface)g(was)g(generated.)
29 b(The)15 b(various)f(endpoints)f(and)i(connections)f(are)i(found)0 2543 y
(in)c(the)f(\252/server/net\272)h(directory)f(in)h(the)f(IP/UDP)i(subdirector\
ies.)k(Further)12 b(xKernel)g(supported)e(protocols)h(should)f(be)0 2600 y
(relatively)g(easy)h(to)g(add.)874 2804 y fc(DRAFT)l(-10)p eop
%%Page: 11 11
 bop 62 42 a fd(All)12 b(of)g(the)g(Unix)g(emulation)f(stuf)o(f)h(was)h(built)
e(into)g(the)h(emulation)f(lib)h(to)g(support)f(unix)g(semantics)h(on)g(top)g
(of)g(the)0 98 y(OSI/XTI)d(\252us)r 14 2 v 14 w(net)r 14 2 v 14 w(I)s 14 2 v
13 w(ifc.h\272)h(generalized)f(interface.)16 b(There)9 b(are)h(README)g(\256l\
es)f(in)g(its)f(source)h(area)h(which)f(give)f(more)0 154 y(info)j(about)f
(the)h(further)g(layout)f(of)h(the)g(sources)g(within.)62 252 y(This)g(server)
h(is)f(not)h(bug)f(free.)19 b(On)12 b(the)f(other)g(hand,)h(it)g(supports)e
(inetd,)h(telnetd)g(ftpd,)h(telnet)f(and)g(ftp.)18 b(\(T)m(o)12 b(use)f(the)0
309 y(daemons,)f(don')n(t)g(for)o(get)f(to)g(start)g(inetd)f(by)h(hand\).)16 b
(Ftp)9 b(transfers)g(are)h(often)f(faster)h(than)e(those)h(of)g(the)g(Mach-UX)
h(single)0 365 y(server)h(system.)62 463 y(Note:)k(The)c(xKernel)g(folk)f(hav\
e)h(created)g(a)g(NetIPC)g(protocol)f(for)h(extending)e(the)i(Mach)s 14 2 v 13
w(IPC)h(semantics)e(between)0 520 y(hosts.)22 b(This)12 b(protocol)g(could)g
(be)i(used)f(so)g(that)f(servers)h(of)h(a)g(Mach-US)g(system)f(can)g(reside)g
(on)g(dif)o(ferent)g(hosts)f(and)0 576 y(proxy)e(could)h(to)f(their)h(standar\
d)g(remote)g(method)g(invocations)e(to)i(get)f(to)h(non-local)f(servers.)62
674 y(The)e(gory)f(details)g(of)h(\257ow)g(of)f(control)g(for)h(a)g(TCP)h(con\
versation)d(can)i(be)g(found)f(in)g(the)h(note:)14 b(\252fs)r 14 2 v 14 w(for\
k)r 14 2 v 14 w(tcp)r 14 2 v 14 w(tour)m(.doc\272)0 838 y fe(6.6.)46 b(PipeNe\
t/Local)10 b(Connection)i(Server)0 967 y fd(This)c(service)h(also)g(supports)
f(the)h(us)r 14 2 v 13 w(net)s 14 2 v 13 w(*)s 14 2 v 13 w(*ifc.h)h(OSI/XTI)f
(based)g(interface)g(and)g(is)g(used)g(to)f(support)g(local)h(endpoints)0 1023
y(for)j(use)f(with)g(local)g(sockets)f(and)i(pipes.)k(The)c(the)f(endpoints/p\
ipes)d(are)k(found)f(in)g(the)h(appropriate)e(subdirectories)g(of)0 1080 y
(the)h(\252/server/pipenet\272)f(area.)17 b(No)11 b(the)g(name)h(is)f(not)f
(very)h(good.)62 1178 y(In)k(many)g(ways,)h(this)e(is)g(a)h(fairly)g(simple/c\
anonical)e(server)m(.)28 b(It)15 b(makes)g(a)g(good)f(example/template)g(for)
h(how)g(to)0 1234 y(make)d(other)f(servers.)0 1398 y fe(6.7.)46 b(T)l(ask)11 b
(Master)0 1527 y fd(This)h(server)h(is)g(speci\256c)g(to)g(UNIX)g(\(4.3bsd\))
f(although)g(it)g(was)h(designed)f(to)h(be)g(easily)f(modi\256able)h(to)g(sup\
port)e(other)0 1583 y(APIs.)16 b(It)7 b(maintains)g(the)h(id)f(spaces)g(for)h
(processes)g(and)f(process)g(groups,)h(it)f(also)h(is)f(used)g(for)h(posting)
e(events)h(\(signals\))g(to)0 1640 y(user)i(processes)f(and)h(groups)e(\(othe\
r)i(than)f(self)h(signaling\).)14 b(It)9 b(is)f(not)g(directly)g(involved)f
(in)i(the)f(forking)g(process)h(\(which)0 1696 y(is)f(done)g(primarily)g(with\
in)f(the)h(emulation)f(lib\).)15 b(It)9 b(is)f(noti\256ed)g(of)g(the)g(existe\
nce)g(of)h(newly)e(forked)i(processes)f(and)g(given)0 1753 y(a)j(us)r 14 2 v
14 w(event)g(object)f(to)g(post)g(events)g(to)h(the)f(new)h(process)g(with.)k
(T)m(ask)c(OSItems)g(can)g(be)g(seen)g(in)f(\252/server/tm/T)l(ASKS\272)0 1809
y(and)h(in)f(\252/server/tm/GROUPS\272)h(there)g(are)h(temporary)f(directorie\
s)f(which)g(correspond)g(to)h(the)f(dif)o(ferent)h(system)g(task)0 1866 y(gro\
ups,)f(and)h(these)g(directories)f(also)h(contain)f(the)h(task)g(items.)16 b
(I)11 b(do)g(not)g(recommend)h(running)d(\252cat\272)j(on)f(these)g(guys.)62
1963 y(The)h(program)f('.../release/bin/us)r 14 2 v 14 w(ps')g(will)f(list)h
(the)g(process)g(ids)g(and)g(the)g(corresponding)f(exec)s 14 2 v 14 w(strings\
,)g(much)i(as)0 2020 y(\252ps\272)f(would.)0 2184 y fe(6.8.)46 b(TTY)11 b(Ser\
ver)0 2313 y fd(This)h(server)h(is)g(sliced)f(in)g(part)h(from)h(the)f(4.3BSD)
g(tty)f(code)h(and)g(some)g(of)g(it)g(is)f(copyrighted)f(to)i(UC)g(\(sorry\).)
22 b(It)13 b(was)0 2369 y(made)d(multi-threaded,)f(and)g(the)g(appropriate)g
(us)r 14 2 v 14 w(byteio)q 14 2 v 14 w(ifc.h)g(and)g(naming)g(interfaces)h
(were)f(glued)g(on)g(top.)15 b(It)10 b(should)0 2426 y(be)j(a)g(fairly)g(simp\
le)g(task)f(to)g(replace)i(the)f(licensed)f(code)h(with)f(the)h(code)g(from)g
(one)g(of)g(the)g(\252free\272)h(bsdoid)d(unixs,)i(but)0 2482 y(time)e(has)g
(not)f(permitted)h(this)f(action.)16 b(The)11 b(ttys)f(and)h(pttys)f(supplied)
f(are)j(found)e(in)h(the)g(\252/server/ttys\272)e(directory)l(.)17 b(The)0
2538 y(are)11 b(made)f(visible)f(in)g(the)h(\252/dev\272)g(directory)f(throug\
h)f(a)j(set)e(of)h(transparent)f(symbolic)g(links.)15 b(Because)c(of)f(a)g
(bug)f(in)h(that)0 2595 y(tslink)f(code,)i(the)f(unix)g(\252ttys\272)g(applic\
ation)f(does)h(not)g(correctly)g(determine)h(your)f(current)g(tty)g(\(inode)g
(numbers)g(are)i(not)0 2651 y(coalescing)e(properly\).)874 2804 y fc(DRAFT)l
(-11)p eop
%%Page: 12 12
 bop 0 42 a fe(6.9.)46 b(Unix)10 b(FileSystem)h(Server)0 170 y fd(The)g(ufs)g
(\256le)h(server)f(reads)h(and)f(writes)g(BSD)g(format)h(disk)e(partitions.)
15 b(Any)c(given)g(server)g(handles)g(exactly)f(one)i(such)0 226 y(partition)
f(\(for)j(no)f(technically)e(good)i(reason.)22 b(Simply)12 b(expandable)h(to)
f(handle)h(more\).)23 b(This)12 b(is)h(another)f(server)i(that)0 283 y(is)g
(partially)f(derived)h(from)h(4.3BSD)g(and)g(the)f(bulk)f(of)i(the)f(work)g
(was)h(done)f(by)g(Paul)g(Roy)h(at)f(the)h(OSF)l(.)g(The)g(client)0 339 y(ser\
vice)c(part)h(of)f(the)g(system)g(is)g(multi-threaded,)g(the)g(low)g(level)g
(disk)f(facilities)g(are)j(accessed)e(via)g(the)g(libus++)f(vnode)0 396 y(int\
erface)h(that)g(supplies)e(a)j(Mach-US)g(byteio)e(external)h(interface.)62 494
y(The)i(\256le)h(server)f(acts)g(as)g(an)g(external)g(pager)g(for)g(its)g(\
\256le)g(proxies)f(that)h(map)g(in)g(windows)e(to)i(the)g(\256les)g(in)f(orde\
r)i(to)0 550 y(support)c(the)h(byteio)f(semantics.)16 b(More)11 b(gory)g(deta\
ils)f(of)h(this)f(can)i(be)f(found)g(in)f(the)h(note:)16 b(\252fs)r 14 2 v 14
w(fork)r 14 2 v 14 w(tcp)r 14 2 v 14 w(tour)m(.doc\272.)0 720 y fe(7.)46 b
(Emulation)10 b(Lib)0 864 y fd(The)20 b(sources)f(for)h(the)g(emulation)f(lib\
rary)g(are)i(found)e(in)g(.../src/lib/emul.)42 b(The)20 b(binary)f(executable)
g(is)h(in)f(../re-)0 921 y(lease/lib/bsd)p 14 2 v 14 w(all.lib.)24 b(It)14 b
(is)f(not)h(a)g(library)g(in)f(the)h(standard)f(sense,)i(instead)e(it)h(is)f
(loaded)g(into)g(the)h(address)g(space)g(of)0 977 y(the)e(initial)f(emulated)
i(process)f(at)h(runtime)f(and)g(inherited)g(by)g(its)g(children.)20 b(It)13 b
(is)f(currently)g(not)g(callable)g(directly)f(by)0 1034 y(user)i(processes)g
(but)f(instead)g(receives)i(user)f(syscalls)e(redirected)j(by)e(the)h(kernel.)
23 b(It)13 b(then)f(simulates)h(the)f(OS)i(API)g(in)0 1090 y(question)f(upon)
g(the)h(generalized)g(system)g(services)g(supplied.)24 b(The)14 b(only)f(emul\
ation)h(lib)f(supported)g(at)h(this)f(time)i(is)0 1147 y(used)c(to)f(support)
g(4.3BSD)i(UNIX)f(semantics.)62 1245 y(The)17 b(program)h("emul)r 14 2 v 14 w
(init")d(is)i(built)f(with)g(the)h(emul)h(lib)e(and)h(is)g(used)g(to)g(load)g
(the)g(emul)r 14 2 v 14 w(lib)f(and)i(redirect)f(its)0 1301 y(syscalls,)12 b
(and)g(exec)g(the)g(initial)f(program.)20 b(Redirecting)12 b(the)g(syscalls)f
(causes)h(the)g(Mach)h(Kernel)f(to)g(forward)g(each)h(of)0 1357 y(the)d(user)
r(')n(s)g(syscalls)f(to)i(a)g(location)e(in)h(the)h(emul)s 14 2 v 13 w(lib)f
(for)h(that)f(task.)16 b(It)11 b(is)f(then)g(sent)g(to)g(the)h(appropriate)f
("emul)r 14 2 v 14 w fc(syscall)p fd(")0 1414 y(routine)g(to)h(execute)g(the)
h(code)f(for)g(that)g(syscall.)16 b(Note)11 b(that)g(these)f(syscall)h(emulat\
ions)f(have)h(the)g(advantage)g(that)g(they)0 1470 y(actually)f(reside)g(in)h
(the)f(address)h(space)g(with)e(the)i(caller)n(,)h(and)e(can)h(access)g(argum\
ent)f(memory)i(directly)e(\(after)h(validity)0 1527 y(checking\).)21 b(The)12
b(user)q(')n(s)h(thread)f(that)g(made)i(the)e(syscall)g(is)g(used)g(to)g(exec\
ute)h(the)f(needed)h(code)g(in)f(the)g(emulation)g(lib)0 1583 y(in)f(a)g(lib)
g(speci\256c)g(stack.)0 1747 y fe(7.1.)46 b(Forking)0 1876 y fd(In)16 b(gener\
al,)h(forking)e(is)g(an)g(action)g(by)h(the)f(emulation)g(library)g(in)g(the)
h(process)f(that)g(called)g(the)h(fork)f(syscall.)29 b(The)0 1932 y(task-mast\
er)11 b(is)g(advised)f(of)h(the)g(intent)f(to)h(fork,)g(and)g(the)g(occurrenc\
e)h(of)f(the)g(fork,)g(but)g(is)f(basically)g(an)i(observer)m(.)62 2030 y(The)
h(basic)e(idea)i(of)f(forking)g(is)f(that)h(the)g(emulation)g(lib)f(creates)i
(a)g(new)f(task)g(that)f(shares)i(the)f(state)g(of)g(the)g(current)0 2087 y
(process,)j(and)f(then)g(sends)f(it)h(on)f(its)h(way)m(.)25 b(The)15 b(proble\
ms)e(come)i(with)e(the)h(cloning)f(of)h(that)g(state.)25 b(In)14 b(multi-thre\
ad)0 2143 y(system,)f(various)e(parts)h(of)g(the)h(emulation)e(lib)h(may)h
(not)e(be)i(appropriate)e(to)h(just)g(be)g(just)f(copied)h(at)h(any)f(time.)
20 b(These)0 2200 y(problems)13 b(are)h(solved)e(through)g(the)h("cloning")d
(mechanism.)23 b(There)14 b(is)f(a)g(clone)g(master)h(object.)22 b(When)13 b
(ever)h(a)f(new)0 2256 y(object)g(is)g(created)h(in)f(the)h(emulation)e(lib,)
i(it)f(is)g(registered)g(with)g(the)g(clone)g(master)o(,)h(and)g(each)g(such)
f(object)g(supplies)0 2313 y(methods:)68 2448 y fb(\017)23 b fd(clone)r 14 2 v
13 w(init:)15 b(Get)c(an)g(object)g(in)g(a)g(consistent)e(state)i(to)g(clone/\
fork.)68 2542 y fb(\017)23 b fd(clone)r 14 2 v 13 w(abort:)16 b(Undo)10 b(the)
h(clone)r 14 2 v 14 w(init,)f(something)g(has)h(gone)g(wrong.)68 2636 y fb
(\017)23 b fd(clone)r 14 2 v 13 w(complete:)16 b(Called)11 b(in)g(the)g(child)
f(to)h(complete)g(the)g(cloning)e(\(reset)j(the)f(object\))874 2804 y fc(DRAF\
T)l(-12)p eop
%%Page: 13 13
 bop 0 42 a fd(These)15 b(methods)f(are)i(invoked)e(for)h(every)h(registered)
e(object)h(at)g(the)g(obvious)e(points)h(in)g(the)h(forking)g(process.)28 b
(For)0 98 y("proxies",)17 b(they)f(are)i(used)e(to)g(insert)h(the)f(send)r 14
2 v 14 w(rights)f(for)i(the)g(remote)g(agents)g(into)e(the)i(child)f(process.)
33 b(\(see)17 b(the)0 154 y(document)8 b(entitled)g("Client)g(Server)i(Intera\
ctions)d(in)i(Multi-Server)g(Operating)f(Systems::)14 b(The)9 b(Mach-US)h(app\
roach")0 211 y(in)h(the)g(\256le)g(\252us)r 14 2 v 14 w(client)r 14 2 v 13 w
(server)n(.ps\272.)62 309 y(Further)16 b(complications)e(happen)h(with)f(mult\
iple)g(threads)h(running)g(at)g(fork)h(time.)29 b(This)15 b(is)g(handled)f
(in)i(a)f(harsh)0 365 y(fashion.)28 b(After)16 b(forking,)f(only)g(one)g(user)
g(thread)g(is)g(created.)30 b(That)15 b(being)f(the)h(forking)f(thread.)29 b
(It)16 b(is)f(used)f(in)h(the)0 422 y(child)g(to)h(complete)g(the)g(forking)f
(code,)i(and)f(then)g(runs)f(the)h(user)r(')m(s)g(child)f(code)h(upon)g(fork)
g(completion.)30 b(It)16 b(is)f(the)0 478 y(user)q(')n(s)e(problem)g(to)g(han\
dle)f(whatever)h(problems)g(this)f(causes)h(in)f(his)h(software.)22 b(Of)13 b
(the)g(emulation)f(lib)h(threads,)g(the)0 535 y(event/signal)f(handling)g(thr\
ead)h(is)g(recreated)i(from)f(scratch)g(in)f(the)h(new)f(process)h(as)f(it)h
(starts)f(up.)23 b(Hence,)16 b(a)e(freshly)0 591 y(forked)c(task)g(will)f(onl\
y)g(have)i(those)e(two)h(threads)g(in)f(it)h(\(other)g(emul)s 14 2 v 13 w(lib)
g(threads)g(occur)g(when)g(a)h(select)f(is)f(done\).)16 b(Even)0 648 y(more)c
(gory)e(details)g(can)i(be)f(found)g(in)f(the)h(note:)16 b(\252fs)r 14 2 v 14
w(fork)r 14 2 v 14 w(tcp)r 14 2 v 14 w(tour)m(.doc\272.)0 817 y fe(8.)46 b
(Naming)10 b(and)i(Name)f(Spaces)0 962 y(8.1.)46 b(Dir)n(ectories,)12 b(Links\
,)g(Named)f(OSItems,)h(and)g(Servers)0 1090 y fd(An)k(involved)e(explanation)
h(of)h(the)g(name)h(system)f(can)g(be)h(found)e(in)h(the)g(\256le)g(\252namin\
g-0891.ps\272)f(titled)g(\252Naming)0 1147 y(Facilities)10 b(for)h(Operation)
g(System)g(Emulation)f(in)g(Mach3.0\272)i(by)f(Daniel)f(Julin.)62 1245 y(A)h
(tour)g(through)f(the)h(process)f(of)i(name)f(resolution)f(can)h(be)g(found)g
(in)f(the)h(note:)16 b(\252fs)r 14 2 v 14 w(fork)s 14 2 v 13 w(tcp)r 14 2 v 14
w(tour)m(.doc\272.)0 1409 y fe(8.2.)46 b(Name)11 b(Spaces)0 1537 y fd(There)f
(are)h(several)f(disjoint)e(name)j(spaces)f(maintained)f(in)h(the)f(multi-ser\
ver)h(environment.)15 b(The)10 b(\256rst)g(one)g(is)g(the)g fe(port)0 1594 y
(name)k(space)f fd(maintained)g(by)f(the)h(con\256guration)f(server)n(.)23 b
(This)12 b(consists)g(of)h(a)h(mapping)e(of)i(ports)e(to)h(server)g(names.)0
1650 y(These)e(names)g(are)g(known)f(by)h(convention)e(to)h(other)h(servers)g
(or)f(programs.)17 b(The)11 b(interface)g(to)f(this)g(service)h(is)f(de\256ne\
d)0 1707 y(by)h(the)g(calls)g fc(netname)r 14 2 v 14 w(check)s 14 2 v 13 w
(in)g fd(and)h fc(netname)q 14 2 v 14 w(look)r 14 2 v 14 w(up)f fd(as)g(speci\
\256ed)g(in)g fc(netname.h)p fd(.)17 b(These)11 b(calls)g(are)h(made)g(on)f
(the)0 1763 y(prede\256ned)g(port)g fc(name)r 14 2 v 14 w(server)r 14 2 v 14 w
(port)p fd(.)62 1861 y(The)h(second)g(name)h(space)f(is)g(the)g fe(pathname)h
(space)p fd(.)20 b(This)12 b(space)g(is)g(maintained)f(by)h(the)g(pathname)h
(server)f(with)0 1917 y(the)f(ns)r 14 2 v 14 w(resolve)f(interface)i(that)e
(maps)i(a)f(pathname)g(to)g(a)g(proxy)g(for)g(the)g(object.)62 2015 y(There)j
(is)g(a)g(third)f(name)i(space)f(de\256ned)g(by)f(a)i fe(pr)o(e\256x)g(table)
f fd(maintained)f(by)h(the)f(emulation)g(library)l(.)26 b(This)13 b(table)0
2072 y(is)e(initialized)f(by)i(the)g(con\256guration)e(server)j(with)e(some)h
("system")e(entries)i(de\256ned)f(in)h(the)g fa(prefix.config)j fd(\256le.)0
2128 y(The)10 b(pre\256x)h(table)e(maps)i(the)f(beginning)e(of)i(path)g(names)
h(to)f(the)g(server)g(that)g(handles)f(names)i(starting)e(with)g(that)g(pre\
\256x.)0 2185 y(Unix-style)h(references)j(to)e(pathnames)h(are)g(handled)f
(by)g(the)h(emulation)f(library)g(which)g(strips)g(of)o(f)h(the)f(longest)g
(pre\256x)0 2241 y(it)g(knows)f(about)g(and)h(hands)f(the)h(rest)g(of)h(the)e
(name)i(to)f(the)g(appropriate)f(server)i(for)f(an)g(ns)r 14 2 v 14 w(resolve\
.)62 2339 y(Most)17 b(servers)g(maintain)f(a)i(name)g(space)f(for)g(the)g(obj\
ects)f(they)g(manage.)35 b(There)18 b(is)e(a)i(UFS)f(server)h(for)f(every)0
2396 y(mounted)12 b(partition,)f(the)h(tty)g(server)h(has)f(a)h(name)g(entry)
f(for)h(each)g(potential)e(tty)g(or)i(pty)l(,)h(the)e(task)r 14 2 v 13 w(mast\
er)h(has)g(a)f(name)0 2452 y(space)g(for)g(all)f(active)g(tasks,)g(and)h(the)
f(pipenet)g(server)h(has)f(a)h(name)g(space)g(for)g(any)f(active)h(pipes.)17 b
(These)11 b(name)h(spaces)0 2509 y(can)f(be)h(accessed)f(through)f(the)h fe
(/servers)g fd(directory)l(.)62 2607 y(In)e(the)g(current)g(con\256guration)f
(setup,)g(all)h(the)g(servers)g(that)f(the)h(con\256guration)e(server)j(start\
s)e(are)h(entered)g(in)g(the)g(port)0 2663 y(name)14 b(space,)g(\(see)f fa
(rc.us)p fd(\))i(for)e(the)g(servers)g(and)g(their)g(names\).)23 b(The)13 b
(pathname)g(server)g(and)g(the)g(UFS)g(servers)g(are)874 2804 y fc(DRAFT)l
(-13)p eop
%%Page: 14 14
 bop 0 42 a fd(given)12 b(initial)f(entries)i(in)f(the)h(pre\256x)g(table)f
(\(see)i fa(prefix.config)p fd(\).)25 b(The)13 b(UFS)g(servers,)h(tty)r 14 2 v
13 w(server)o(,)g(task)r 14 2 v 13 w(master)o(,)0 98 y(pipenet)r 14 2 v 13 w
(server)e(and)g(net)r 14 2 v 14 w(server)g(are)h(all)e(given)g(entries)g(in)h
(the)g(pathname)f(space)h(in)g(the)f(directory)h fa(/servers)p fd(.)21 b(\(se\
e)0 154 y fa(STARTUP.fsadmin)p fd(\).)26 b(The)12 b(UFS)i(servers)e(and)h(pat\
hname)g(server)g(are)g(given)f fa(transparent)30 b(symlinks)16 b fd(in)0 211 y
(the)11 b fe(/)g fd(directory)f(in)h(order)g(to)g(make)h(this)e(directory)g
(look)h(more)g(like)g(a)g(traditional)f(Unix)g(root)h(directory)l(.)0 380 y fe
(9.)46 b(Pr)o(otection)11 b(Model)0 525 y fd(In)18 b(accordance)g(with)f(the)
h(principle)e(of)i(using)f(generic)g(interfaces,)j(the)e(access)g(control)e
(interface)i(is)g(based)f(on)h(a)0 581 y(single)10 b(protection)f(model,)i
(of)h(which)e(the)h(models)f(of)h(the)g(various)f(tar)o(get)h(environments)e
(should)h(be)h(either)g(subsets)e(or)0 638 y(reasonable)i(variations.)k(This)
10 b(model)h(is)g(or)o(ganized)f(around)h(three)g(basic)g(concepts:)68 773 y
fb(\017)23 b fd(each)17 b(operation)f(exported)g(by)g(an)h(agency)g(is)f(asso\
ciated)g(with)g(a)h(set)g(of)g fc(access)g(rights)p fd(.)32 b(Those)16 b(righ\
ts)f(are)114 830 y(normally)c(established)g(and)h(stored)g(in)g(the)g(agent)g
(when)g(this)f(agent)h(is)g(created.)21 b(The)12 b(appropriate)f(rights)g(mus\
t)114 886 y(be)g(present)g(in)f(the)h(agent)g(if)g(the)g(corresponding)e(oper\
ation)h(is)h(to)g(be)g(allowed)f(to)h(the)g(client.)68 980 y fb(\017)23 b fd
(each)13 b(client)e(is)h(associated)g(with)f(a)i(list)e(of)i fc(cr)n(edential\
s)e fd(representing)g(its)h(identity)-5 b(,)13 b(associated)f(with)f(the)h
(corre-)114 1036 y(sponding)c(agent.)16 b(These)11 b(credentials)e(are)j(a)f
(simple)f(ordered)h(list)e(of)i(32-bit)e fc(authentication)f(identi\256ers)p
fd(,)h(which)114 1093 y(may)14 b(be)g(obtained)f(from)h(the)g(authentication)
e(server)i(upon)f(presentation)g(of)h(an)g(unfor)n(geable)g fc(authentication)
114 1149 y(token)p fd(.)i(The)11 b(token)f(itself)h(is)f(created)i(by)f(the)g
(authentication)d(server)o(,)j(from)h(a)g(user)q(')n(s)f(password.)68 1243 y
fb(\017)23 b fd(each)10 b(agency)f(logically)f(contains)g(an)h fc(access)h
(contr)m(ol)f(list)f fd(or)h fc(ACL)p fd(.)i(This)d(list)g(is)h(an)h(ordered)
f(list)g(of)g(entries,)h(each)114 1300 y(containing)g(an)i(authentication)d
(identi\256er)j(and)f(a)i(set)e(of)h(access)g(rights.)18 b(The)12 b(agency)g
(exports)f(an)h(operation)f(to)114 1356 y(match)g(a)h(list)e(of)h(credentials)
f(against)g(the)h(ACL,)h(and)f(determine)g(the)g(set)g(of)g(access)h(rights)d
(thus)i(authorized)f(for)114 1412 y(that)i(client.)22 b(In)14 b(addition,)e
(each)i(agency)f(speci\256es)g(a)h fc(privileged)d(identi\256er)p fd(.)22 b
(Presence)14 b(of)f(this)f(identi\256er)h(in)g(a)114 1469 y(list)d(of)h(crede\
ntials)f(causes)h(all)g(access)g(checks)g(to)g(be)g(bypassed,)g(and)g(all)g
(access)g(rights)f(to)h(be)g(authorized.)0 1633 y fe(9.1.)46 b(Access)11 b
(Contr)o(ol)g(Interface)0 1762 y fd(Given)16 b(this)f(model,)j(clients)e(acqu\
ire)g(access)h(to)f(an)h(item)g(by)f(obtaining)e(access)j(to)f(an)h(agent)f
(via)h(a)g(proxy)e(object.)0 1818 y(The)d(agent)g(contains)g(the)g(credential\
s)f(of)i(the)f(client,)g(and)g(a)h(set)f(of)h(enabled)f(access)h(rights.)19 b
(Those)11 b(access)i(rights)e(are)0 1874 y(speci\256ed)f(by)g(the)g(client)f
(\(under)h(the)g(restrictions)e(imposed)h(by)h(the)g(access)g(control)g(list\
\),)f(which)h(indicates)e(in)i(this)f(way)0 1931 y(what)g(operations)e(it)i
(intends)f(to)g(perform)i(on)f(the)g(item)g(\(e.g.)16 b(read-only)9 b(\256le,)
h(read-write,)g(etc.\).)16 b(The)9 b(main)h(primitive)e(in)0 1987 y(the)i(acc\
ess)g(control)f(interface,)i(to)f(be)g(invoked)e(against)i(one)f(proxy)h(obje\
ct,)g(returns)f(a)i(new)f(proxy)f(object)g(representing)0 2044 y(the)h(same)h
(item,)g(but)e(with)h(dif)n(ferent)h(credentials)e(and/or)h(access)g(rights,)
g(subject)f(to)h(mediation)f(through)g(the)h(ACL)g(and)0 2100 y(authenticatio\
n)g(mechanisms.)21 b(The)12 b(system)g(has)h(special)f(bootstrap)e(mechanisms)
j(to)f(create)h(an)g(agent/proxy)e(object)0 2157 y(with)d("anonymous")f(crede\
ntials,)i(and)g(simple)g(rules)g(for)g(inheritance)f(of)i(credentials)e(when)
h(an)g(operation)f(on)h(one)g(item)0 2213 y(must)i(return)g(access)g(to)g(ano\
ther)g(item.)62 2311 y(The)h(other)g(primitives)e(in)h(the)h(access)g(control)
f(interface)h(can)h(be)f(used)f(to)g(query)h(the)g(status)e(of)i(agent)g(\(cr\
edentials)0 2368 y(and)h(enabled)f(access)h(rights\),)g(\256nd)g(out)f(the)g
(privileged)g(identi\256er)g(for)h(a)g(given)f(item,)i(or)f(manipulate)f(acce\
ss)h(control)0 2424 y(lists.)874 2804 y fc(DRAFT)l(-14)p eop
%%Page: 15 15
 bop 0 42 a fe(10.)45 b(Expanding)12 b(Servers)0 186 y(10.1.)45 b(Expanding)
12 b(and)g(Adding)f(Interfaces)0 315 y fd(One)d(obvious)f(question)g(to)h(ask)
g(is:)14 b("How)8 b(do)g(I)h(add)f(a)h(service)g(method)f(to)g(this)f(stuf)o
(f)h(that)g(is)g(accessible)g(to)g(an)h(emulation)0 371 y(lib.")h(or)h(just)g
("how)f(do)h(I)g(expand)g(a)g(server)r(')n(s)g(interface".)62 469 y(It)g(is)g
(a)h(bit)e(involved,)g(but)g(is)h(done)g(in)f(the)h(following)e(way:)68 599 y
fb(\017)23 b fd(Read)9 b(the)f(paper)h(entitled)e(\252Object-Oriented)h(Inter\
faces)h(in)f(the)g(Mach)i(3.0)e(Multi-Server)r(\272)h(by)f(Paulo)g(Guedes)h
(in)114 655 y(the)e(\256le)i(\252i-wooos-91.ps\272.)k(It)8 b(supplies)f(a)h
(general)g(discussion)d(of)j(the)g(class)g(hierarchy)f(and)h(abstract)g(class\
/proxy)114 711 y(use.)19 b(Also)12 b(have)g(at)g(hand)g(the)g(document)g(desc\
ribing)f(the)h(magic)h(macros)g(used)e(in)h(lib/us++)e(class)i(de\256nitions)
114 768 y(to)i(make)h(this)e(all)i(work.)26 b(That)14 b(document)g(also)g(by)
h(Paulo,)g(is)f(titled)f(\252Libus++)g(Reference)j(Manual\272)f(and)g(is)114
824 y(found)10 b(in)h(the)g(\256le)g(\252libus-ref-1192.ps\272.)68 916 y fb
(\017)23 b fd(Add)10 b(your)h(method\(s\))g(to)f(an)i(existing)d(a)i(service)
h(interface,)f(or)h(create)f(another)g(service)g(interface.)168 1007 y fe(\
\261)23 b fd(choose)11 b(which)h(interface)g(you)g(wish)f(to)h(expand.)19 b
(Find)12 b(the)g(appropriate)f(existing)g(.../include/us)q 14 2 v 14 w(*)r 14
2 v 14 w(ifc.h)214 1064 y(interface)h(that)f(is)g(responsible)f(for)i(the)g
(functionality)d(you)i(want)h(to)f(expand,)h(or)g(create)g(a)h(new)e(one)h
(to)f(do)214 1120 y(the)g(work)g(you)g(desire.)18 b(These)11 b(interface)h
(\256le)g(all)f(represent)g(abstract)g(C++)h(classes.)17 b(In)12 b(order)f
(to)g(create)i(a)214 1176 y(new)g(interface,)h(just)e(copy)h(another)f(us)r 14
2 v 14 w(*)s 14 2 v 13 w(ifc.h)i(interface)f(and)g(change)g(the)g(names/metho\
ds)f(as)h(needed)214 1233 y(for)e(your)g(purposes.)168 1304 y fe(\261)23 b fd
(Add)10 b(your)h(method)f(signature.)16 b(If)11 b(a)h(method)e(is)h(to)g(be)g
(accessible)f(to/through)f(a)i(proxy)l(,)h(the)f("REMOTE")214 1360 y(meta-key\
word)g(most)g(occur)h(on)f(the)g(line)g(with)g(the)g(method)g(name.)18 b(All)
11 b(such)g(methods)g(must)g(return)g(the)214 1416 y(type)f("mach)s 14 2 v 14
w(error)s 14 2 v 13 w(t")168 1487 y fe(\261)23 b fd(Describe)12 b(the)h(messa\
ge)g(format)g(for)g(remote)h(method)e(invocation.)20 b(In)13 b(the)g(.../lib/\
us++)e(directory)l(,)j(there)214 1544 y(are)g(\256les)f(whose)f(names)i(corre\
spond)e(with)h(those)f(of)h(the)g(us)r 14 2 v 14 w(*)s 14 2 v 13 w(ifc.h)h
(\256les)f(of)g(the)g(form)h(us)r 14 2 v 14 w(*.cc.)23 b(These)214 1600 y(\
\256les)14 b(contain)e(descriptions)g(of)i(how)g(to)f(pack/unpack)g(the)h(met\
hod)f(arguements)g(for)h(shipping)e(to)h(other)214 1656 y(processes.)23 b(The)
14 b(details)e(of)i(this)f(format)h(are)g(found)f(in)h(the)f(`Libus++)f(Refer\
ence)j(Manual\272)f(in)f(the)h(\256le)214 1713 y(\252libus-ref-1192.ps\272,)c
(check)h(the)g(section)f(on)h("Remote)g(Method)g(Ar)o(guments)f(Strings".)168
1784 y fe(\261)23 b fd(Supply)12 b(the)h(protection)f(for)i(the)f(method.)22 b
(There)14 b(is)f(a)h(\256le)f(.../lib/us++/access)q 14 2 v 13 w(table.cc)h
(that)f(describes)214 1840 y(the)g(protections)g(needed)h(for)g(each)h(remote\
ly)f(accessible)f(method.)25 b(Make)15 b(your)f(addition)e(in)i(the)f(same)
214 1896 y(form)f(as)f(the)h(others)e(there.)18 b(Note:)e(Not)11 b(all)g(meth\
ods)g(from)h(a)g(us)r 14 2 v 14 w(*)r 14 2 v 14 w(ifc.h)f(interface)h(need)g
(to)f(be)g(remotely)214 1953 y(accessible.)21 b(Some)13 b(of)g(them)g(may)h
(be)e(for)i(use)e(internal)g(to)g(the)h(servers)g(that)f(use)h(them.)21 b(Oth\
ers)13 b(may)g(be)214 2009 y(supplied)c(by)i(proxies)f(directly)g(and)h(have)
g(no)g(need)g(for)h(corresponding)d(remote)j(calls.)214 2073 y(This)d(access)
h(table)f(is)h(used)f(by)h(agent)g(objects)f(to)g(determine)h(of)g(a)h(client)
e(has)g(the)h(appropriate)f(permission)214 2129 y(to)h(invoke)g(the)h(method)
g(in)g(question)e(against)h(the)h(agency)g(\(OSItem\))h(it)f(represents.)168
2200 y fe(\261)23 b fd(Build)5 b(the)i(default)f(proxies.)14 b(In)7 b(.../lib\
/proxies,)f(the)g("make)h(")f(process)h(uses)f(a)h(script)f(called)g("proxy)q
14 2 v 14 w(default")214 2256 y(for)i(building)d(the)j(simple)f(proxies)g(tha\
t)g(merely)i(forward)e(methods)h(to)f(the)h(server)m(.)16 b(This)7 b(lib)g
(must)g(be)h(rebuilt)214 2313 y(whenever)h(the)g(.../include/us)q 14 2 v 14 w
(*)s 14 2 v 13 w(ifc.h)h(\256les)f(are)h(changed.)16 b(The)9 b(script)g(uses)
g(those)f(\256les)i(to)f(build)f(the)h(".cc")214 2369 y(and)i(".h")f(\256les)
h(for)h(supporting)c(those)j(proxies,)f(and)h(they)g(are)h(then)e(compiled)h
(into)f(libproxies.a.)114 2461 y(At)g(this)g(point)g(the)h(interface)g(is)g
(set)g(and)g(ready)g(to)g(go,)g(but)f(there)h(are)h(no)f(actual)g(implementat\
ions)e(yet)i(in)g(place.)68 2552 y fb(\017)23 b fd(Adding)9 b(implementations\
:)168 2644 y fe(\261)23 b fd(Modify)15 b(other)h(users)g(of)g(the)g(interface\
.)32 b(At)16 b(this)f(point,)i(all)e(of)i(the)f(various)f(implementation)g
(classes)214 2700 y(\(.cc)i(and)e(.h)h(\256les\))g(that)f(inherit)g(from)h
(the)g(changed)g(interface)g(must)f(be)h(updated)f(to)g(support)g(the)g(new)
874 2804 y fc(DRAFT)l(-15)p eop
%%Page: 16 16
 bop 214 42 a fd(method.)15 b(Either)10 b(a)h(real)g(implementation)d(can)j
(be)g(done)e(if)i(that)f(is)f(what)h(is)g(desired,)g(or)h(a)g(dummy)f(form)h
(of)214 98 y(the)h(method)h(must)f(be)h(put)f(in,)h(Generally)f(something)g
(that)g(just)g(returns,)h(US)r 14 2 v 14 w(NOT)r 14 2 v 14 w(IMPLEMENTED,)214
154 y(MACH)s 14 2 v 13 w(OBJECT)s 14 2 v 13 w(NO)s 14 2 v 13 w(SUCH)s 14 2 v
14 w(OPERA)-5 b(TION,)16 b(or)g(ERR)s 14 2 v 14 w(SUCCESS.)i(C++)e(will)f(com\
plain)g(if)h(all)g(of)214 211 y(the)11 b(methods)f(are)i(not)e(\256lled)h(out)
g(for)g(implementation)f(classes)g(that)h(are)h(instantiated.)214 274 y(Findi\
ng)c(these)h(classes)h(may)g(be)g(a)g(bit)f(of)g(a)i(challenge,)e(since)h(the\
y)f(can)h(be)g(most)f(anywhere)h(in)f(the)h(system)214 330 y(either)j(in)g
(servers,)h(libs)e(or)i(the)f(emulation)f(lib.)23 b(A)13 b(class)g(browser)n
(,)h(or)f(\256nd/grep)g(should)f(do)h(the)g(job)g(for)214 387 y(you.)23 b(Rem\
ember)15 b(where)e(it)g(is)g(that)g(you)g(found)g(classes)g(which)f(implement)
i(these)f(interfaces,)h(because)214 443 y(they)c(can)i(make)g(a)f(useful)g
(template)f(when)h(creating)g(your)g(own)f(implemention.)168 513 y fe(\261)23
b fd(Now)9 b(it)f(is)h(\256nally)g(time)g(to)g(create)h(the)f(implementation)
f(for)i(the)f(method)g(that)f(you)h(actually)g(wanted.)15 b(This)214 569 y
(is)f(fairly)h(simple.)27 b(All)14 b(incoming)g(object)g(args)g(have)h(been)g
(coalesced,)h(protection)e(has)h(been)g(handled.)214 626 y(When)e(adding)f
(the)h(new)g(method)g(to)g(the)g(implementation)f(you)g(want)h(to)g(change,)h
(just)e(do)h(it.)23 b(The)13 b(only)214 682 y(fancy)18 b(parts)g(come)g(in)g
(if)g(you)g(are)g(creating)g(a)h(new)f(OSItem,)j(are)d(returning)f(an)i(objec\
t)e(as)h(an)g(OUT)214 739 y(parameter)o(,)11 b(or)g(need)g(to)f(determine)h
(what)f("agency")g(is)g(associated)g(with)g(a)h(given)f("agent")f(IN)i(parame\
ter)o(.)214 795 y(These)i(questions)e(are)j(handled)f(below)g(in)g(section)f
fe(??)23 b fd(on)13 b("Objects)f(as)i(Method)f(Ar)o(guments".)22 b(Again,)214
852 y(using)9 b(similar)i(implementations)f(can)h(be)g(a)h(helpful)e(guide.)
214 915 y(Note:)20 b(vol)r 14 2 v 13 w(agency)14 b(is)f(a)h(necessary)f(ances\
tor)h(class)f(for)h(all)f(OSItem)h(implementation)e(classes)h(that)g(are)214
971 y(not)e(\256le)s 14 2 v 13 w(system)h(classes.)18 b(V)-6 b(ol)r 14 2 v 13
w(agencies)12 b(support)e(the)i(directory)f(semantics,)h(as)g(well)f(as)h(sup\
porting)d(the)214 1028 y(standard)15 b(protection)g(associated)h(with)g(an)g
(object)g(itself)g(\(like)g(\256le)h(protection\).)31 b(Many)17 b(OSItem')n
(s)g(in)214 1084 y(the)12 b(system)f(derive)h(directly)f(from)i(this)e(class)
h(and)g(support)e(their)i(speci\256c)g(semantics)g(through)e(multiple)214 1141
y(inheritance)g(of)h(the)g(abstract)g(class)g(which)f(represents)h(the)g(OSIt\
ems)g(speci\256c)g(interface.)68 1231 y fb(\017)23 b fd(Finally)10 b(we)h(mus\
t)g(deal)h(with)e(the)h(proxies.)16 b(For)11 b(most)g(instances)f(the)h(defau\
lt)g(proxy)g(is)f(suf)o(\256cient)h(for)h(handling)114 1287 y(the)g(additiona\
l)e(method,)j(but)f("special")f(proxies)h(are)h(required)f(in)g(cases)h(where)
g(there)f(is)g(a)h(desire)g(to)f(do)g(some)114 1344 y(form)f(of)h(caching)e
(of)i(data)f(or)g(alternate)g(method)f(for)i(communicating)e(data)h(\(shared)
g(mem)h(objects,...\).)114 1417 y(First,)k(\256nd)f(any)g(other)g("special")f
(proxies)h(for)g(the)g(interface)h(that)f(you)f(are)i(changing,)g(and)f(expan\
d)g(them)h(to)114 1474 y(handle)10 b(the)g(new)h(method)f(as)h(needed.)16 b
(All)10 b(such)g(proxy)g(implementations)f(should)g(be)i(found)f(in)g(.../lib\
/proxies.)114 1530 y(There)g(may)h(be)g(none,)f(also,)h(there)f(may)h(not)f
(be)h(one)f(which)g(is)g(returned)g(by)g(the)g(implementation)f(class\(es\))i
(that)114 1587 y(you)f(are)i(most)f(interested)f(in)h(modifying.)114 1660 y
(A)i(simple)f(example)i(of)f(a)h(special)e(proxy)h(is)g(the)f("tm)s 14 2 v 13
w(task)r 14 2 v 14 w(proxy\272.)22 b(This)12 b(proxy)h(does)g(some)g(simple)g
(caching)114 1717 y(of)e(task)h(ids.)17 b(Hence)12 b(id)f(queries)h(need)f
(not)g(always)h(go)f(back)h(to)f(the)g(task)r 14 2 v 14 w(master)n(.)18 b(In)
12 b(order)g(to)f(create)i(a)f(special)114 1773 y(proxy)l(,)f(examine)h(the)f
(task)f(proxy)h(and)g(then)f(take)h(the)g(following)e(steps:)168 1863 y fe
(\261)23 b fd(Create)15 b(a)g(new)f(proxy)g(class.)26 b(This)14 b(is)g(done)g
(by)g(inheriting)f(from)i(the)f(default)g(proxy)g(for)h(the)f(interface)214
1920 y(in)19 b(question)e(and)j(then)f(overriding)f(the)h(methods)f(that)h
(need)h(proxy)e(local)h(implementations.)40 b(This)214 1976 y(overriding)13 b
(may)j(involve)e(calling)g(the)h(default)f(method)h(in)g(order)g(to)g(get)g
(initial)e(values,)j(or)g(it)e(may)i(be)214 2033 y(necessary)g(to)g(create)h
(other)e(methods)h(not)f(available)h(to)g(the)g(user)g(through)f(the)h(proxy)
l(.)32 b(In)16 b(extremely)214 2089 y(complex)11 b(cases,)h(an)g(administrati\
ve)e(abstract)h(interface)h(can)g(be)f(created,)i(that)e(is)g(also)g(supporte\
d)f(by)h(the)214 2146 y(server)j(implementation)e(class)h(for)h(the)f(object)
g(represented,)h(and)g(is)f(called)g(in)h(order)f(to)h(support)e(proxy)214
2202 y(unique)e(calculations.)15 b(This)10 b(is)g(done)h(for)h(\256le)f(proxi\
es)f(to)h(help)g(support)e(\256le)j(windows.)168 2272 y fe(\261)23 b fd(Retur\
ning)7 b(the)h(correct)g(proxy)l(.)16 b(Normally)l(,)9 b(an)f(object)g(return\
ed)g(as)g(an)g(out)f(parameter)i(will)e(be)h(instantiated)214 2328 y(in)j(the)
h(client)f(address)h(space)g(as)h(a)f(default)g(proxy)f(of)h(the)g(type)f(in)
h(question.)18 b(In)12 b(order)g(to)g(get)g(a)g(dif)o(ferent)214 2385 y(proxy)
e(instantiated,)f(the)i(following)e(magic)j(must)f(be)g(done.)253 2454 y fb
(\003)23 b fd(Edit)10 b(the)h(\256les)g(.../lib/emul/)p fb(f)p fd(emul)q 14 2
v 14 w(user)r 14 2 v 14 w(init.cc,emul)r 14 2 v 14 w(all.cc)p fb(g)p fd(.)253
2517 y fb(\003)23 b fd(Find)10 b(the)h(lines)f(\252INSER)n(T)s 14 2 v 13 w
(CLASS)t 14 2 v 13 w(IN)s 14 2 v 14 w(MAP\(tm)s 14 2 v 14 w(task)q 14 2 v 14 w
(proxy)l(,)i("tm)r 14 2 v 14 w(task)r 14 2 v 13 w(proxy"\);\272)253 2580 y fb
(\003)23 b fd(Make)11 b(a)h(similar)f(entry)f(in)h(each)h(\256le)f(for)h(your)
e(special)h(proxy)f(to)h(insert)f(it)h(into)f(the)h(class)g(map.)253 2644 y fb
(\003)23 b fd(Find)13 b(the)g(\256le)h(that)f(supplies)f(the)h(object)g(imple\
mentation)g(for)g(which)g(the)h(proxy)f(is)g(being)g(created)299 2700 y(\(eg.)
j(.../server/tm/tm)s 14 2 v 14 w(task.cc\).)874 2804 y fc(DRAFT)l(-16)p eop
%%Page: 17 17
 bop 253 42 a fb(\003)23 b fd(Override)14 b(the)g fc(r)n(emote)s 14 2 v 13 w
(class)r 14 2 v 14 w(name)g fd(method)g(in)g(that)g(class)h(to)f(return)g(the)
h(quoted)e(string)h(that)g(you)299 98 y(used)c(in)h(the)g(class)g(map)g(above\
.)214 171 y(Further)i(discussion)d(on)j(how)g(to)f(manipulate)h(objects)f(as)
h(in/out)e(arguments)h(to)h(methods)f(can)i(be)f(found)214 227 y(in)d(the)h
(following)e(section)i fe(??)k fd(titled)10 b("Objects)g(as)h(Method)g(Ar)o
(guments".)0 392 y fe(10.2.)45 b(Objects)13 b(as)d(Method)i(Arguments)0 520 y
fd(Usually)-5 b(,)17 b(the)d(way)h(a)g(client)f(gets)g(a)h(new)f(object)g(is)
h(as)f(an)h(out)f(argument)g(of)h(a)g(method)f(to)g(a)h(dif)o(ferent)g(object\
.)26 b(The)0 577 y(question)9 b(arises,)j(how)e(to)h(specify)g(those)f(ar)o
(guments)h(and)g(how)f(to)h(implement)g(them.)62 675 y(In)d(general)f(there)g
(is)g(a)g(desire)g(to)g(have)g(an)h("agency")e(\(server)h(maintained,)h(exter\
nally)e(available\))h(object)f(represented)0 731 y(by)j(an)g("agent")f(in)h
(the)g(server)n(,)h(and)f(it)g(must)f(be)i(represented)e(by)h(a)h("proxy")d
(on)i(the)g(client)f(side.)16 b(Since)9 b(the)g(default)f(agent)0 787 y(has)h
(always)g(been)g(used)g(\(although)f(specialized)h(ones)g(can)g(be)h(created\
\),)g(the)g(class)e(of)i(objects)e(speci\256ed)h(in)g(the)h(abstract)0 844 y
(interfaces)g(is)f(the)g(most)g(complex)h(antecedent)f(class)g(shared)h(by)f
(the)g(agent)h(class)f(and)g(the)h(and)f(the)h(proxy)f(classes.)15 b(This)0
900 y(causes)10 b(the)f(class)h(types)f(of)h(object)f(sent)h(or)f(received)i
(via)e(remote)i(methods)e(to)g(be)h(speci\256ed)g(in)f(the)h(interfaces)g(as)
g(being)0 957 y("usItem")h(as)g(de\256ned)h(in)f(.../include/us)q 14 2 v 14 w
(item)r 14 2 v 14 w(ifc.h.)18 b(This)11 b(restriction)f(is)h(not)g(necessary)
g(for)h(objects)f(not)f(represented)0 1013 y(by)g(agents,)g(but)f(since)h(it)
g(is)g(agents)f(that)h(handle)f(the)h(access)h(control/restriction)c(for)j
(remote)h(objects,)e(such)h(objects)f(are)0 1070 y(described)i(in)f(the)h(abs\
tract)g(interfaces)g(as)g("usItem"s.)62 1168 y(Given)e(that)f(the)h(interface)
h(type)e(of)h(an)h(remote)f(object)g(is)f(usItem,)i(\(even)g(though)d(it)i
(was)g(instantiated)e(by)i(the)g(remote)0 1224 y(method)15 b(runtime)g(as)g
(the)g(correct)h(proxy)e(type\))h(it)g(is)f(necessary)i(to)e(reshape)i(it)e
(into)h(the)g(correct)g(type)g(before)g(more)0 1281 y(specialized)g(methods)f
(can)i(be)g(called.)29 b(This)15 b(is)g(done)g(by)g(using)f(the)h("castdown")
f(mechanism)h(to)h(change)f(its)g(type)0 1337 y(to)e(be)h(that)f(of)h(the)f
(abstract)h(class)f(which)g(has)g(the)h(correct)g(semantic)f(for)h(the)g(prox\
y)f(in)g(question.)22 b(Examples)14 b(of)f(the)0 1394 y(cast)f(down)g(appear)
h(regularly)e(in)h(the)g(emulation)g(lib)f(source.)20 b(The)13 b fc(ns)r 14 2
v 13 w(type)s 14 2 v 13 w(t)g fd(returned)f(with)f(OUT)h(objects)f(from)i(the)
0 1450 y(naming)e(interface)g(can)h(be)f(helpful)f(in)h(determining)f(how)g
(to)h(castdown)f(an)h(object.)62 1548 y(Furthermore,)19 b(on)e(the)f(server)h
(side,)h(you)f(want)f(to)g(return)h(to)f(the)h(client)f(an)h(agent)f(to)h(acc\
ess)g(an)g(object)f(being)0 1604 y(returned.)g(T)m(o)11 b(create)h(such)e(an)
i(agent,)f(one)g(must)g(take)g(the)g(following)e(steps.)68 1740 y fb(\017)23 b
fd(Check)11 b(an)g(example.)17 b(A)11 b(good)g(one)g(is)f(in)h(\252tm)s 14 2 v
14 w(task::tm)q 14 2 v 13 w(get)s 14 2 v 13 w(tgrp\272)g(in)g(the)g(\256le)g
(.../server/tm/tm)s 14 2 v 14 w(task.cc.)68 1834 y fb(\017)23 b fd(Get)10 b
(the)f(identity)g(to)g(associate)h(with)f(the)g(new)h(agent.)16 b(Assuming)9 b
(that)g(the)h(the)g(agent)g(is)f(meant)i(to)e(represent)h(the)114 1890 y(curr\
ent)k(caller)n(,)h(then)e(the)h(std)r 14 2 v 13 w(cred)h(for)f(the)g(current)
g(agent)f(is)h(acquired)f(via)h(the)g(ns)r 14 2 v 14 w(get)r 14 2 v 14 w(cred)
r 14 2 v 14 w(obj)f(against)g(the)114 1946 y(agent.)68 2040 y fb(\017)23 b fd
(Then)13 b(do)g(a)i("new")d(for)i(the)g(agent)f(class)h(using)e(the)i(identit\
y)e(in)h(question,)g(the)g(desired)h(access)g(for)g(this)e(agent)114 2097 y
(\(like)e(read-only)h(for)g(an)g(open\),)h(and)f(the)g(actual)g(agency)g(bein\
g)f(exported.)68 2191 y fb(\017)23 b fd(Free)e(un-needed)e(references.)44 b
(At)20 b(this)f(point,)i(the)f(new)g(agent)g(holds)e(a)j(reference)g(for)f
(the)g(agency)g(and)114 2247 y(the)15 b(std)q 14 2 v 14 w(cred.)29 b(When)15 b
(the)g(method)f(implementation)g(no)h(longer)f(needs)h(these)g(objects,)h(the)
f(references)h(held)114 2303 y(by)f(the)g(method)g(itself)f(must)h(be)h(relea\
se)g(via)f("mach)r 14 2 v 14 w(object)r 14 2 v 14 w(dereference")h(\(see)f
(section)g fe(??)28 b fd(\252Class/Object)114 2360 y(Semantics/Control\272)10
b(for)h(more)h(info.\))68 2454 y fb(\017)23 b fd(Return)11 b(the)g(new)g(agen\
t.)874 2804 y fc(DRAFT)l(-17)p eop
%%Page: 18 18
 bop 0 42 a fe(10.3.)45 b(Class/Object)11 b(Semantics/Contr)o(ol)0 170 y fd
(Classes)d(in)g(the)g(system)g(can)h(be)f(separated)h(into)e(two)h(groups,)g
("normal")g(classes)g(and)g("contained")e(classes.)15 b(All)8 b(normal)0 226 y
(classes)13 b(have)h(as)g(an)g(ancestor)f(the)h(class)f("usT)-5 b(op".)24 b
(The)14 b(only)e(classes)h(that)h(are)g(not)f(progeny)g(of)h(usT)l(op)f(are)i
(classes)0 283 y(used)c(as)i(parts)e(of)h(other)g(classes)f(and)h(occur)g(as)
g(the)g(types)f(of)h(instance)f(variables)g(within)f(those)i(classes.)18 b
(Note:)f(there)0 339 y(can)e(never)h(exist)e(pointers)f(or)j(references)g(to)
e(contained)g(classes.)28 b(Instances)14 b(of)h(contained)f(classes)h(occur)g
(entirely)0 396 y(within)8 b(a)j(normal)f(class,)g(and)g(are)g(used)g(only)f
(to)h(support)e(similar)i(functionality)d(in)j(separate)g(normal)g(classes.)
15 b(The)10 b(rest)0 452 y(of)h(this)f(discussion)f(will)h(be)h(talking)f(abo\
ut)g(normal)i(objects)e(in)g(the)h(system)g(unless)f(explicitly)f(speci\256ed\
.)62 550 y(Object)i(garbage)h(collection/lifetime)e(is)h(handled)g(through)g
(a)h(simple)f(reference)i(count)e(mechanism.)19 b(References)0 607 y(are)12 b
(logically)d("held")h(by)h(individual)e(parts)h(of)i(code)f(by)g(the)f(follow\
ing)g(rules:)68 729 y fb(\017)23 b fd(Upon)10 b(creation,)h(a)h(reference)g
(is)f(automatically)f(taken)g(and)h(given)g(to)f(the)h(caller)h(of)f(the)g
("new")f(function.)68 818 y fb(\017)23 b fd(When)11 b(a)h(copy)f(of)h(a)g(poi\
nter)e(to)h(an)h(object)f(is)g(made,)i(then)e(another)g(reference)h(must)g
(be)f(taken.)18 b(References)12 b(are)114 875 y(taken)e(via)h(the)g("mach)s 14
2 v 14 w(object)q 14 2 v 14 w(reference")h(routine.)68 963 y fb(\017)23 b fd
(When)11 b(a)h(copy)e(of)i(a)g(pointer)e(will)g(no)h(longer)g(be)h(used,)f
(then)g(the)g(associated)f(reference)j(must)e(be)h(released)f(with)114 1020 y
("mach)r 14 2 v 14 w(object)r 14 2 v 13 w(dereference".)68 1108 y fb(\017)23 b
fd(When)14 b(an)h(object)f(is)h(returned)f(as)h(an)g(OUT)f(parameter)i(to)f
(a)g(method,)h(then)e(that)g(method')m(s)h(reference)h(to)e(the)114 1165 y
(object)c(is)h(passed)f(with)g(it.)68 1254 y fb(\017)23 b fd(Similarly)l(,)15
b(if)g(an)f(object)f(is)h(received)h(as)f(an)g(out)g(parameter)h(to)f(a)g(met\
hod,)h(then)f(the)g(caller)g(receives)g(a)h(refer-)114 1310 y(ence,)i(and)d
(is)h(responsible)e(for)j(disposing)c(of)j(it)g(either)g(by)f(passing)g(it)h
(on)f(to)h(its)f(caller)n(,)j(or)e(releasing)f(it)h(with)114 1367 y("mach)r 14
2 v 14 w(object)r 14 2 v 13 w(dereference".)68 1455 y fb(\017)23 b fd(When)11
b(the)f(reference)j(count)d(on)h(an)g(object)g(goes)g(to)f(zero,)i(then)f(the)
g(destructor)f(of)h(the)g(object)g(is)f(automatically)114 1512 y(called.)62
1634 y(This)f(is)h(all)f(well)g(and)h(good,)g(but)f(what)g(about)g(OSItems)i
(in)e(directories?)15 b(Since)10 b(all)g(OSItem,)h(including)c(things)i(like)
0 1691 y(tasks)j(and)i(network)e(endpoints,)h(are)h(found)e(in)h(some)h(syste\
m)f(directory)l(,)h(by)f(the)g(rules)g(given)g(above,)h(that)f(directory)0
1747 y(should)f(hold)h(a)h(reference)h(to)f(the)f(objects)g(representing)g
(those)g(items.)24 b(This)13 b(would)g(mean)h(that)f(they)h(would)e(not)h(go)
0 1804 y(away)g(until)f(all)g(normal)h(references)h(to)f(them)g(went)g(away)m
(,)h(and)e(the)h(directory)f(reference)j(was)e(removed.)22 b(This)12 b(extra)
0 1860 y(directory)e(reference)i(would)d(prevent)h(the)h(proper)f(deallocatio\
n)f(of)i(volatile/transient)c(system)j(objects.)16 b(The)10 b(problem)0 1917 y
(is)17 b(solved)f(by)h(the)g(use)g(of)g("vol)r 14 2 v 13 w(agency")g(objects.)
34 b(For)17 b(these)g(objects,)h(the)f(directory)g(does)g(not)f(hold)g(a)i
(counted)0 1973 y(reference)12 b(to)f(the)g(object.)16 b(The)11 b(destructor)
f(for)h(the)g(object)g(is)f(called)h(even)h(though)d(it)i(is)g(in)f(a)i(direc\
tory)l(.)62 2071 y(A)e(more)h(specialized)e(class)h(is)g(the)f(tmp)s 14 2 v 14
w(agency)h(class.)15 b(Objects)10 b(that)f(derive)h(from)h(the)e(class)h(magi\
cally)g(disappear)0 2128 y(from)16 b(their)f(directory)g(when)h(the)f(counted)
g(references)h(all)g(go)f(away)m(.)30 b(T)m(o)15 b(further)h(this)e(paradigm,)
j(there)f(is)f(even)h(a)0 2184 y(tmp)r 14 2 v 14 w(directory)l(,)c(which)e
(goes)h(away)h(when)e(it)h(no)g(longer)f(has)h(anything)f(in)h(it.)16 b(Tmp)r
14 2 v 14 w(directories)10 b(are)i(currently)f(used)g(to)0 2240 y(represent)j
(job)f(groups,)i(so)e(that)h(when)g(the)g(last)f(task)h(in)f(a)i(job)e(group)
h(completes,)g(then)g(the)g(group)f(itself)h(does)f(also.)0 2297 y(There)e
(is)g(further)g(documentation)f(on)g(tmp)s 14 2 v 14 w(objects)g(in)g(the)h
(note)g("temp-agencies-US47.note\272.)0 2459 y fe(10.4.)45 b(Error)11 b(Repor\
ting)0 2587 y(Error)f(Return)h(V)l(alues)45 b fd(Standard)10 b(error)h(noti\
\256cation)d(in)i(Mach-US)h(is)f(done)f(via)h(the)g(return)g(value)g(of)g(eac\
h)h(routine.)0 2644 y(That)h(is)g(of)g(type)g(mach)s 14 2 v 14 w(error)s 14 2
v 13 w(t)g(\(an)h(int\))f(and)g(the)g(error)h(values)e(are)i(de\256ned)g(in)e
(.../include/*err*.h)h(and)g(are)h(itemized)0 2700 y(in)e(the)g(\252includes\
\272)f(section)g(4)h(above.)874 2804 y fc(DRAFT)l(-18)p eop
%%Page: 19 19
 bop 62 42 a fd(The)7 b(emulation)e(lib)h(arbitrarily)g(translates)f(these)i
(values)e(into)h(UNIX)g(error)i(numbers)e(\(see)h(\256les)g(.../lib/emul/emul)
q 14 2 v 14 w(error*\).)0 98 y(This)j(indirect)g(mapping)h(may)g(be)h(a)f(sou\
rce)g(of)h(incorrect)e(error)i(values)f(in)f(some)i(cases.)62 196 y(When)22 b
(pre-existing)e(UNIX)i(code)g(was)g(used)f(in)h(servers,)j(those)c(UNIX)h(err\
or)g(values)g(are)g(translated)f(into)0 252 y(mach)s 14 2 v 14 w(errors)s 14 2
v 13 w(t)11 b(values.)16 b(This)10 b(is)h(done)g(on)f(a)i(case)g(by)e(case)i
(basis)e(wherever)i(errors)f(occur)n(.)0 417 y fe(Diagnostic)h(Error)i(Report\
ing)45 b fd(See)15 b(the)e(section)g(6)g(on)g(the)h(diagnostic)d(server)j(and)
g(section)e(on)h(debugging)f(tech-)0 473 y(niques.)0 637 y fe(10.5.)45 b(Inte\
rrupts)0 766 y fd(There)10 b(is)f(an)h(extensive)f(system)g(for)h(handling)e
(interrupts)h(in)g(either)h(servers)f(or)h(the)g(emulation)f(library)l(.)16 b
(Correct)10 b(use)g(of)0 822 y(this)h(system)h(is)f(essential)g(for)h(correct)
h(system)e(expansion.)18 b(Most)12 b(notably)-5 b(,)13 b(long)e(running)g(met\
hod)h(implementations)0 879 y(in)f(a)g(server)g(must)g(be)g(interruptible.)k
(T)l(o)c(learn)g(the)g(details)f(of)h(this)f(system,)h(read)g(the)g(note)f
(entitled)g("Interrupts.note".)62 977 y(In)i(general,)h(there)f(are)h(routine\
s)e(called)h(\252intr)r 14 2 v 14 w(mach)s 14 2 v 13 w(msg\272,)h(and)f(\252i\
ntr)r 14 2 v 14 w(cond)r 14 2 v 14 w(wait\272)f(that)h(should)e(be)j(used)e
(in)h(code)0 1033 y(executed)c(by)h(threads)f(that)g(may)h(be)g(executing)e
(any)i(syscall)f(path.)15 b(In)8 b(the)h(emulation)f(lib,)g(this)g(will)f(gen\
erally)h(not)g(come)0 1089 y(up)13 b(as)h(the)g(remote)g(object)f(invocation)
e(runtime)j(system)f(takes)g(care)i(of)f(this)e(for)i(interruptible)e(RPCs)i
(\(see)g(\252Method)0 1146 y(Ar)o(guement)9 b(Strings\272)g(section)g(of)g
(the)h(`Libus++)d(Reference)k(Manual\272\).)17 b(For)10 b(more)g(complex)f
(situations)e(of)j(long)f(term)0 1202 y(computations)g(or)j(other)e(forms)i
(of)f(waits,)g(the)g(details)f(found)g(the)h(the)g(interrupts)e(note)i(are)h
(necessary)m(.)0 1372 y fe(11.)45 b(Cr)o(eating)11 b(new)h(servers)0 1516 y fd
(Probably)i(the)h(simplest)e(way)i(to)f(do)h(this)f(is)g(to)g(look)g(at)h(wha\
t)g(the)f(pipenet)g(server)h(does)f(and)h(modify)f(create)i(a)f(new)0 1573 y
(modi\256ed)c(version)f(of)h(it)g(for)g(your)g(own)g(purposes.)0 1742 y fe
(12.)45 b(Debugging)0 1887 y fd(Needles)15 b(to)g(say)m(,)i(debugging)c(this)
i(system)g(can)g(be)h(a)g(bit)f(complex.)29 b(Each)15 b(server)h(has)f(many)h
(service)f(threads)g(and)0 1943 y(async)f(noti\256cation)g(of)g(object)g(deat\
h.)27 b(There)15 b(are)h(many)f(servers)g(in)f(the)g(system,)i(and)f(the)f
(emulation)g(lib)g(converts)0 2000 y(the)i(actual)g(unix)f(system)g(calls)h
(into)f(a)h(series)g(of)g(server)h(calls.)31 b(It)16 b(has)g(multiple)e(threa\
ds)i(for)g(servicing)f(incoming)0 2056 y(signals/interrupts,)d(waiting,)h(lis\
tening)f(on)i(the)g(various)f(objects)g(in)h(a)g(select,)h(or)f(supporting)e
(simultaneous)g(syscall)0 2113 y(emulation.)62 2211 y(W)m(e)21 b(have)g(found)
g(no)f(magic)i(bullets)d(for)j(solving)d(this)h(complexity)-5 b(.)47 b(But)21
b(we)h(do)e(have)h(a)h(series)f(of)g(tech-)0 2267 y(niques/wrenches)9 b(that)
i(we)g(use)g(to)g(hunt)f(and)h(kill)f(bugs.)0 2431 y fe(12.1.)45 b(T)l(echniq\
ue)0 2560 y fd(The)15 b(easiest)f(environment)g(to)h(debug)f(in)h(is)f(to)h
(run)g(Mach-US)h(beside)e(the)h(Mach-UX)g(single)f(server)i(system.)27 b(The)
0 2616 y(general)12 b(idea)f(is)h(to)f(try)g(and)h(limit)f(where)h(the)f(prob\
lem)h(may)g(be)g(using)e(test)h(cases)h(and)g(system)f(diagnostics)e(followed)
0 2673 y(by)i(time)g(in)g(GDB.)874 2804 y fc(DRAFT)l(-19)p eop
%%Page: 20 20
 bop 62 42 a fd(Y)l(ou)18 b(run)g(Mach-US)h(as)f(you)g(normally)g(would)f(wit\
h)h(Mach-UX.)h(GDB)f(is)g(run)g(in)g(a)h(standard)f(single)f(server)0 98 y
(window)-5 b(.)24 b(Not)13 b(one)g(started)g(via)g(the)g("con\256g)r 14 2 v 13
w(server".)23 b(Y)l(ou)13 b(run)g(GDB)g(against)g(the)g(executable)g(in)g(que\
stion,)f(either)0 154 y(the)d(appropriate)g(server)o(,)h(or)g(a)g(local)f(cop\
y)h(of)g(bsd)q 14 2 v 14 w(all.lib.)15 b(Then)10 b(attach)f(to)g(the)h(task)f
(you)g(are)i(interested)d(in,)i(put)f(in)h(your)0 211 y(break)h(points)f(and)
h(run)g(your)f(test)h(in)g(a)g(Mach-US)h(shell.)62 309 y(Since)18 b(the)f(con\
\256g)r 14 2 v 14 w(server)g(supports)e(a)j(Mach)s 14 2 v 14 w(US)f(port)g
(name)h(space)f(\(eg.)35 b(snames\))17 b(and)g(Mach-US)h(does)f(not)0 365 y
(support)10 b(a)i(separate)g("mach)s 14 2 v 14 w(id")e(server)i(running)f(on)
g(a)h(system,)g(one)g(cannot)f(easily)g(run)g(GDB)h(in)f(an)h(window)f(starte\
d)0 422 y(by)h(the)f(con\256g)h(server)h(and)e(thus)g(a)i(server)f(or)g(emula\
ted)g(process)g(can)g(not)f(be)h(run)g(from)h(inside)d(of)j(a)f(GDB.)h(One)e
(must)0 478 y(attach.)62 576 y(There)f(are)g(some)g(magical)f(switches)f(supp\
orted)g(by)h(the)h(servers)f(and)g(emul)s 14 2 v 14 w(init)f(that)h(will)f
(help)h(and)g(are)h(used)f(when)0 633 y(invoking)g(the)i(part)g(of)g(the)g
(system)g(in)f(question.)68 768 y fb(\017)23 b fd(-d<number>:)j(this)16 b(swi\
tch)g(speci\256es)g(a)h(debug)f(level.)34 b(These)16 b(debug)g(levels)g(are)i
(used)e(by)h(various)f(debug)114 824 y(statements)11 b(throughout)f(the)j(sys\
tem)f(to)g(vomit)g(debuging)e(and)j(status)e(info)h(while)g(running.)19 b(The\
se)12 b(messages)114 881 y(are)j(sent)f(to)g(the)g(diagnostic)f(server)h(that)
g(then)g(prints)g(them)g(out)g(for)h(the)f(user)m(.)27 b(The)14 b(higher)g
(the)g(number)n(,)i(the)114 937 y(greater)h(the)g(tonnage)f(of)i(information.)
33 b(Levels)16 b(1,2,3,99)i(are)f(the)g(only)g(ones)f(used.)34 b(Many)18 b
(of)f(the)g(debug)114 994 y(statements)9 b(will)g(be)h(conditional)e(on)h(a)i
(global)e(variable)g(that)h(can)g(be)g(set)g(from)h(GDB)f(to)f(turn)h(on)g
(that)f(additional)114 1050 y(set)i(of)h(debugging)e(messages)i(that)f(may)h
(not)f(be)h(needed)g(when)f(debugging)f(other)i(parts)f(of)h(the)f(system.)18
b(Level)114 1107 y(3)11 b(does)f(syscall)g(tracing.)68 1200 y fb(\017)23 b fd
(-D<number>:)15 b(This)10 b(switch)g(to)h(emul)s 14 2 v 13 w(init)g(speci\256\
es)g(a)g(debug)g fc(depth)p fd(.)16 b(If)c(value)e(given)h(is)g(7,)g(then)g
(the)g(7th)g(level)114 1257 y(deep)16 b(of)g(exec)g(calls)g(will)f(suspend)f
(the)i(emulation)f(lib)h(in)f(that)h(exec)g(call,)h(and)f(the)g(process)g(is)
f(ready)h(to)g(be)114 1313 y(attached)11 b(to)h(with)f(GDB,)i(break)f(points)
e(set,)j(and)f(of)o(f)g(you)g(go.)19 b(Further)12 b(more,)h(this)e(value)h
(is)f(used)h(for)g(a)h(magic)114 1370 y(suspension)8 b(points.)15 b(If)c(one)
f(is)g(trying)f(to)h(debug)g(a)h(feature)g(of)f(forking,)g(then)g(one)h(needs)
f(to)g(be)h(able)f(to)g(attach)h(to)114 1426 y(the)f(new)g(process)g(early)h
(in)f(the)g(fork)g(process)g(\(GDB)h(does)f(bad)g(things)f(when)h(you)f(are)j
(attached)e(across)g(a)h(fork\).)114 1483 y(Hence)h(the)f(value)h(of)g("-D99")
e(is)i(used)f(to)g(suspend)g(fork)h(at)g(such)f(a)h(useful)f(point.)18 b(Othe\
rs)11 b(can)h(be)g(added)f(at)h(the)114 1539 y(developers)e(convenience.)68
1633 y fb(\017)23 b fd(-s:)15 b(This)9 b(switch)g(causes)h(most)g(servers)g
(to)g(stop)f(shortly)f(after)j(parsing)e(its)h(ar)o(gs)g(before)g(doing)f(any)
h(actual)g(work.)114 1689 y(This)g(is)g(useful)h(for)g(debugging)f(server)h
(startup.)0 1825 y(T)m(o)18 b(use)h(the)f(above)h(switches,)h(one)e(generally)
h(edits)e(the)i("rc.us")f(\256le)h(to)g(give)f(the)g(appropriate)g(switches)g
(to)g(the)0 1881 y(appropriate)10 b(server)n(,)h(or)f(modify)g(the)g("multi")
f(script)h(to)g(start)f(emul)s 14 2 v 14 w(init)g(with)g(the)h(correct)h(swit\
ches)e(for)i(the)f(emulation)0 1938 y(lib)g(\(bsd)r 14 2 v 14 w(all.lib\).)0
2102 y fe(12.2.)45 b(Emulation)11 b(lib)g(debugging)0 2230 y fd(GDB)j(can)h
(attach)f(to)g(tasks)f(using)g(their)h(mach)s 14 2 v 14 w(id)g(from)h("ms")e
(preceded)i(by)f(a)g(minus.)26 b(Currently)l(,)16 b(the)e(name)h(of)f(an)0
2287 y(emulated)e(process)f(will)g(show)g(up)g(in)g("ms")g(output)g(as)g("non\
e")g(and)h(the)f(correct)h(process)g(is)f(determined)g(by)h(knowing)0 2343 y
(what)f(you)f(started)h(last.)62 2441 y(In)j(order)f(to)g(debug)f(both)g(a)i
(user)f(program)h(and)f(the)g(emulation)f(lib,)h(one)g(can)h(start)e(GDB)i
(against)e(the)h(emulation)0 2498 y(lib,)e(and)g(load)g(the)g(user)g(program)
g(symbols)f(at)i(location)e(0x10000.)15 b(This)10 b(way)h(you)g(can)h(stop)e
(at)h(a)h(good)e(place)i(in)f(your)0 2554 y(user)g(program)g(before)h(putting)
d(breakpoints)h(into)g(the)h(emulation)f(lib)g(itself.)874 2804 y fc(DRAFT)l
(-20)p eop
%%Page: 21 21
 bop 0 42 a fe(12.3.)45 b(Fsadmin)0 170 y fd(There)17 b(exists)f(a)i(program)
g(for)f(calling)f(the)h(various)g(system)f(servers)h(directly)l(.)35 b(It)18 b
(is)e(called)h fc(fsadmin)p fd(.)34 b(It)17 b(is)g(used)0 226 y(by)f("rc.us")
g(at)g(startup)g(to)g(mount)f(the)h(various)g(servers)g(in)g(the)g(pathname)h
(name)g(space,)h(but)e(can)g(also)g(be)h(used)f(to)0 283 y(call)e(a)g(number)
f(of)h(built)f(in)g(commands)h(\(ls,cpto,cpfrom,...\).)25 b(It)14 b(can)g(be)
g(simply)f(modi\256ed)g(to)h(call)f(any)h(method,)g(or)0 339 y(combination)d
(of)h(methods)f(seen)h(in)g(the)g(.../include/us)q 14 2 v 14 w(*)r 14 2 v 14 w
(ifc.h)g(interfaces.)19 b(It)13 b(can)f(be)g(directed)g(at)g(a)h(given)e(serv\
er)n(,)i(or)0 396 y(use)e(the)f(pathname)h(server)h(by)e(default.)16 b(It)11 b
(is)g(important)f(to)g(note)h(that)f(whatever)h(server)g(it)f(is)h(pointed)e
(at)i(will)f(show)g(up)0 452 y(as)j("/")f(within)f(fsadmin.)22 b(Hence)13 b
(the)g(normal)g("/")f(would)g(be)h(found)f(in)g("/ufs")g(and)h(the)f(other)h
(servers)g(would)f(also)g(be)0 509 y(seen)f(as)h(subdirectories)e(of)h("/".)
17 b(This)11 b(process)g(is)g(made)h(slightly)d(more)j(complex)f(by)h(the)f
(fact)h(that)f(fsadmin)g(does)g(not)0 565 y(load)g(the)g(table)f(of)h(system)
g(path)g(pre\256xes)g(either)m(.)62 663 y(Fsadmin)16 b(would)g(need)g(to)g
(be)h(run)f(in)g(a)h(shell)e(or)i(window)e(started)h(by)g(the)g(con\256g)r 14
2 v 14 w(server)g(\(instead)g(of)h(starting)0 720 y(emul)s 14 2 v 13 w(init\)\
,)g(or)e(it)h(could)f(be)h(started)f(directly)g(by)g(the)h(con\256g)r 14 2 v
14 w(server)g(\(see)g(the)g(document)f(entitled)f(\252Installing)g(and)0 776 y
(Running)c(Mach-US\272)i(in)f(the)g(\256le)g(\252us-install.ps\272\))0 940 y
fe(12.4.)45 b(Other)13 b(debugging)e(packages)0 1069 y fd(In)g(the)f(.../pkg)
h(part)f(of)h(the)f(source)h(subtree,)f(there)h(is)f(a)h fc(malloc)f fd(packa\
ge)h(that)f(can)h(be)f(used)g(for)h(tracing)f(leaks)h(if)f(linked)0 1125 y
(in)g(to)h(the)f(executable)g(in)h(question.)j(There)d(are)h(associated)d(scr\
ipts/progs)g(for)h(processing)g(the)g(raw)h(data)g(into)f(a)h(usable)0 1182 y
(form.)17 b(For)12 b(more)f(detail)g(here)g(read)h(the)f(note)f(in)h(the)g
(\256le:)16 b(\252malloc-tracer-US29.note\272.)62 1280 y(There)c(is)f(also)g
(a)h(package)g(for)f(recording)g(error)h(msg)g(ids)f(into)f(a)i(ring)f(buf)o
(fer)h(at)g(runtime.)17 b(This)10 b(is)h(useful)g(for)h(bugs)0 1336 y(that)h
(might)g(be)g(effected)g(by)h(the)f(timing)f(cost)h(of)h(the)f(standard)g(deb\
ugging)e(\(-d\))j(messages,)g(and)g(the)f(corresponding)0 1393 y(IPC)f(to)e
(the)g(diagnostic)f(server)m(.)17 b(This)9 b(module)i(is)f(found)g(in)g(.../l\
ocal)s 14 2 v 13 w(include/logging.h,)e(.../lib/us++/logging.*.)k(The)0 1449 y
(log)r 14 2 v 13 w(reset)k(and)f(log)r 14 2 v 14 w(dump)g(routines)f(would)g
(be)i(called)f(from)h(inside)e(GDB.)i(Examples)f(of)h(use)f(are)h(in)f(the)h
(lib/us++)0 1505 y(sources.)874 2804 y fc(DRAFT)l(-21)p eop
%%Trailer
 end
%%EOF
